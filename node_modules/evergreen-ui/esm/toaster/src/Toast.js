import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import React, { memo, useMemo, useRef, useState, useEffect, useCallback } from 'react';
import { css } from 'glamor';
import PropTypes from 'prop-types';
import { Transition } from 'react-transition-group';
import Box from 'ui-box';
import Alert from '../../alert/src/Alert';
var animationEasing = {
  deceleration: 'cubic-bezier(0.0, 0.0, 0.2, 1)',
  acceleration: 'cubic-bezier(0.4, 0.0, 1, 1)',
  spring: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'
};
var ANIMATION_DURATION = 240;
var openAnimation = css.keyframes('openAnimation', {
  from: {
    opacity: 0,
    transform: 'translateY(-120%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});
var closeAnimation = css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});
var animationStyles = css({
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  height: 0,
  transition: "all ".concat(ANIMATION_DURATION, "ms ").concat(animationEasing.deceleration),
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: "".concat(openAnimation, " ").concat(ANIMATION_DURATION, "ms ").concat(animationEasing.spring, " both")
  },
  '&[data-state="exiting"]': {
    animation: "".concat(closeAnimation, " 120ms ").concat(animationEasing.acceleration, " both")
  }
});
var Toast = /*#__PURE__*/memo(function Toast(props) {
  var children = props.children,
      duration = props.duration,
      hasCloseButton = props.hasCloseButton,
      _props$intent = props.intent,
      intent = _props$intent === void 0 ? 'none' : _props$intent,
      isShownProp = props.isShown,
      onRemove = props.onRemove,
      title = props.title,
      zIndex = props.zIndex;
  var transitionRef = useRef(null);

  var _useState = useState(true),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var _useState3 = useState(0),
      _useState4 = _slicedToArray(_useState3, 2),
      height = _useState4[0],
      setHeight = _useState4[1];

  var closeTimer = useRef(null);
  var clearCloseTimer = useCallback(function () {
    if (closeTimer.current) {
      clearTimeout(closeTimer.current);
      closeTimer.current = null;
    }
  }, []);
  var close = useCallback(function () {
    clearCloseTimer();
    setIsShown(false);
  }, [clearCloseTimer]);
  var startCloseTimer = useCallback(function () {
    if (duration) {
      clearCloseTimer();
      closeTimer.current = setTimeout(function () {
        close();
      }, duration * 1000);
    }
  }, [duration, clearCloseTimer, close]);
  useEffect(function () {
    startCloseTimer();
    return function () {
      clearCloseTimer();
    };
  }, [startCloseTimer, clearCloseTimer]);
  useEffect(function () {
    if (isShownProp !== isShown && typeof isShownProp === 'boolean') {
      setIsShown(isShownProp);
    }
  }, [isShown, isShownProp]);
  var handleMouseEnter = useCallback(function () {
    return clearCloseTimer();
  }, [clearCloseTimer]);
  var handleMouseLeave = useCallback(function () {
    return startCloseTimer();
  }, [startCloseTimer]);
  var onRef = useCallback(function (ref) {
    if (ref === null) return;

    var _ref$getBoundingClien = ref.getBoundingClientRect(),
        rectHeight = _ref$getBoundingClien.height;

    setHeight(rectHeight);
  }, []);
  var styles = useMemo(function () {
    return {
      height: height,
      zIndex: zIndex,
      marginBottom: isShown ? 0 : -height
    };
  }, [isShown, height, zIndex]);
  return /*#__PURE__*/React.createElement(Transition, {
    nodeRef: transitionRef,
    appear: true,
    unmountOnExit: true,
    timeout: ANIMATION_DURATION,
    "in": isShown,
    onExited: onRemove
  }, function (state) {
    return /*#__PURE__*/React.createElement("div", {
      ref: transitionRef,
      "data-state": state,
      className: animationStyles,
      onMouseEnter: handleMouseEnter,
      onMouseLeave: handleMouseLeave,
      style: styles
    }, /*#__PURE__*/React.createElement(Box, {
      ref: onRef,
      padding: 8
    }, /*#__PURE__*/React.createElement(Alert, {
      flexShrink: 0,
      appearance: "card",
      elevation: 3,
      intent: intent,
      title: title,
      isRemoveable: hasCloseButton,
      onRemove: close,
      pointerEvents: "all"
    }, children)));
  });
});
Toast.propTypes = {
  /**
   * The z-index of the toast.
   */
  zIndex: PropTypes.number,

  /**
   * Duration of the toast.
   */
  duration: PropTypes.number,

  /**
   * Function called when the toast is all the way closed.
   */
  onRemove: PropTypes.func,

  /**
   * The type of the alert.
   */
  intent: PropTypes.string,

  /**
   * The title of the alert.
   */
  title: PropTypes.node,

  /**
   * Description of the alert.
   */
  children: PropTypes.node,

  /**
   * When true, show a close icon button inside of the toast.
   */
  hasCloseButton: PropTypes.bool,

  /**
   * When false, will close the Toast and call onRemove when finished.
   */
  isShown: PropTypes.bool
};
export default Toast;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdC5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsIm1lbW8iLCJ1c2VNZW1vIiwidXNlUmVmIiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJ1c2VDYWxsYmFjayIsImNzcyIsIlByb3BUeXBlcyIsIlRyYW5zaXRpb24iLCJCb3giLCJBbGVydCIsImFuaW1hdGlvbkVhc2luZyIsImRlY2VsZXJhdGlvbiIsImFjY2VsZXJhdGlvbiIsInNwcmluZyIsIkFOSU1BVElPTl9EVVJBVElPTiIsIm9wZW5BbmltYXRpb24iLCJrZXlmcmFtZXMiLCJmcm9tIiwib3BhY2l0eSIsInRyYW5zZm9ybSIsInRvIiwiY2xvc2VBbmltYXRpb24iLCJhbmltYXRpb25TdHlsZXMiLCJkaXNwbGF5IiwiZmxleERpcmVjdGlvbiIsImFsaWduSXRlbXMiLCJoZWlnaHQiLCJ0cmFuc2l0aW9uIiwiYW5pbWF0aW9uIiwiVG9hc3QiLCJwcm9wcyIsImNoaWxkcmVuIiwiZHVyYXRpb24iLCJoYXNDbG9zZUJ1dHRvbiIsImludGVudCIsImlzU2hvd25Qcm9wIiwiaXNTaG93biIsIm9uUmVtb3ZlIiwidGl0bGUiLCJ6SW5kZXgiLCJ0cmFuc2l0aW9uUmVmIiwic2V0SXNTaG93biIsInNldEhlaWdodCIsImNsb3NlVGltZXIiLCJjbGVhckNsb3NlVGltZXIiLCJjdXJyZW50IiwiY2xlYXJUaW1lb3V0IiwiY2xvc2UiLCJzdGFydENsb3NlVGltZXIiLCJzZXRUaW1lb3V0IiwiaGFuZGxlTW91c2VFbnRlciIsImhhbmRsZU1vdXNlTGVhdmUiLCJvblJlZiIsInJlZiIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInJlY3RIZWlnaHQiLCJzdHlsZXMiLCJtYXJnaW5Cb3R0b20iLCJzdGF0ZSIsInByb3BUeXBlcyIsIm51bWJlciIsImZ1bmMiLCJzdHJpbmciLCJub2RlIiwiYm9vbCJdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU9BLEtBQVAsSUFBZ0JDLElBQWhC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Q2hCO0FBQ0Y7QUFDQTtBQUNFNUIsRUFBQUEsT0FBTyxFQUFFOUIsU0FBUyxDQUFDMEQ7QUF2Q0gsQ0FBbEI7QUEwQ0EsZUFBZW5DLEtBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgbWVtbywgdXNlTWVtbywgdXNlUmVmLCB1c2VTdGF0ZSwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgY3NzIH0gZnJvbSAnZ2xhbW9yJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHsgVHJhbnNpdGlvbiB9IGZyb20gJ3JlYWN0LXRyYW5zaXRpb24tZ3JvdXAnXG5pbXBvcnQgQm94IGZyb20gJ3VpLWJveCdcbmltcG9ydCBBbGVydCBmcm9tICcuLi8uLi9hbGVydC9zcmMvQWxlcnQnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgZGVjZWxlcmF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuMCwgMC4wLCAwLjIsIDEpJyxcbiAgYWNjZWxlcmF0aW9uOiAnY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAxLCAxKScsXG4gIHNwcmluZzogJ2N1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIwLCAxLjE3NSknXG59XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDI0MFxuXG5jb25zdCBvcGVuQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnb3BlbkFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIG9wYWNpdHk6IDAsXG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTIwJSknXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSdcbiAgfVxufSlcblxuY29uc3QgY2xvc2VBbmltYXRpb24gPSBjc3Mua2V5ZnJhbWVzKCdjbG9zZUFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJyxcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAnc2NhbGUoMC45KScsXG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgaGVpZ2h0OiAwLFxuICB0cmFuc2l0aW9uOiBgYWxsICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7YW5pbWF0aW9uRWFzaW5nLmRlY2VsZXJhdGlvbn1gLFxuICAnJltkYXRhLXN0YXRlPVwiZW50ZXJpbmdcIl0sICZbZGF0YS1zdGF0ZT1cImVudGVyZWRcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtvcGVuQW5pbWF0aW9ufSAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke2FuaW1hdGlvbkVhc2luZy5zcHJpbmd9IGJvdGhgXG4gIH0sXG4gICcmW2RhdGEtc3RhdGU9XCJleGl0aW5nXCJdJzoge1xuICAgIGFuaW1hdGlvbjogYCR7Y2xvc2VBbmltYXRpb259IDEyMG1zICR7YW5pbWF0aW9uRWFzaW5nLmFjY2VsZXJhdGlvbn0gYm90aGBcbiAgfVxufSlcblxuY29uc3QgVG9hc3QgPSBtZW1vKGZ1bmN0aW9uIFRvYXN0KHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBjaGlsZHJlbixcbiAgICBkdXJhdGlvbixcbiAgICBoYXNDbG9zZUJ1dHRvbixcbiAgICAvLyBUZW1wbGF0ZSBwcm9wc1xuICAgIGludGVudCA9ICdub25lJyxcbiAgICBpc1Nob3duOiBpc1Nob3duUHJvcCxcbiAgICBvblJlbW92ZSxcbiAgICB0aXRsZSxcbiAgICB6SW5kZXhcbiAgfSA9IHByb3BzXG5cbiAgY29uc3QgdHJhbnNpdGlvblJlZiA9IHVzZVJlZihudWxsKVxuICBjb25zdCBbaXNTaG93biwgc2V0SXNTaG93bl0gPSB1c2VTdGF0ZSh0cnVlKVxuICBjb25zdCBbaGVpZ2h0LCBzZXRIZWlnaHRdID0gdXNlU3RhdGUoMClcbiAgY29uc3QgY2xvc2VUaW1lciA9IHVzZVJlZihudWxsKVxuXG4gIGNvbnN0IGNsZWFyQ2xvc2VUaW1lciA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAoY2xvc2VUaW1lci5jdXJyZW50KSB7XG4gICAgICBjbGVhclRpbWVvdXQoY2xvc2VUaW1lci5jdXJyZW50KVxuICAgICAgY2xvc2VUaW1lci5jdXJyZW50ID0gbnVsbFxuICAgIH1cbiAgfSwgW10pXG5cbiAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgY2xlYXJDbG9zZVRpbWVyKClcbiAgICBzZXRJc1Nob3duKGZhbHNlKVxuICB9LCBbY2xlYXJDbG9zZVRpbWVyXSlcblxuICBjb25zdCBzdGFydENsb3NlVGltZXIgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKGR1cmF0aW9uKSB7XG4gICAgICBjbGVhckNsb3NlVGltZXIoKVxuICAgICAgY2xvc2VUaW1lci5jdXJyZW50ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNsb3NlKClcbiAgICAgIH0sIGR1cmF0aW9uICogMTAwMClcbiAgICB9XG4gIH0sIFtkdXJhdGlvbiwgY2xlYXJDbG9zZVRpbWVyLCBjbG9zZV0pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBzdGFydENsb3NlVGltZXIoKVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNsZWFyQ2xvc2VUaW1lcigpXG4gICAgfVxuICB9LCBbc3RhcnRDbG9zZVRpbWVyLCBjbGVhckNsb3NlVGltZXJdKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzU2hvd25Qcm9wICE9PSBpc1Nob3duICYmIHR5cGVvZiBpc1Nob3duUHJvcCA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICBzZXRJc1Nob3duKGlzU2hvd25Qcm9wKVxuICAgIH1cbiAgfSwgW2lzU2hvd24sIGlzU2hvd25Qcm9wXSlcblxuICBjb25zdCBoYW5kbGVNb3VzZUVudGVyID0gdXNlQ2FsbGJhY2soKCkgPT4gY2xlYXJDbG9zZVRpbWVyKCksIFtjbGVhckNsb3NlVGltZXJdKVxuICBjb25zdCBoYW5kbGVNb3VzZUxlYXZlID0gdXNlQ2FsbGJhY2soKCkgPT4gc3RhcnRDbG9zZVRpbWVyKCksIFtzdGFydENsb3NlVGltZXJdKVxuXG4gIGNvbnN0IG9uUmVmID0gdXNlQ2FsbGJhY2socmVmID0+IHtcbiAgICBpZiAocmVmID09PSBudWxsKSByZXR1cm5cblxuICAgIGNvbnN0IHsgaGVpZ2h0OiByZWN0SGVpZ2h0IH0gPSByZWYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcbiAgICBzZXRIZWlnaHQocmVjdEhlaWdodClcbiAgfSwgW10pXG5cbiAgY29uc3Qgc3R5bGVzID0gdXNlTWVtbyhcbiAgICAoKSA9PiAoe1xuICAgICAgaGVpZ2h0LFxuICAgICAgekluZGV4LFxuICAgICAgbWFyZ2luQm90dG9tOiBpc1Nob3duID8gMCA6IC1oZWlnaHRcbiAgICB9KSxcbiAgICBbaXNTaG93biwgaGVpZ2h0LCB6SW5kZXhdXG4gIClcblxuICByZXR1cm4gKFxuICAgIDxUcmFuc2l0aW9uXG4gICAgICBub2RlUmVmPXt0cmFuc2l0aW9uUmVmfVxuICAgICAgYXBwZWFyXG4gICAgICB1bm1vdW50T25FeGl0XG4gICAgICB0aW1lb3V0PXtBTklNQVRJT05fRFVSQVRJT059XG4gICAgICBpbj17aXNTaG93bn1cbiAgICAgIG9uRXhpdGVkPXtvblJlbW92ZX1cbiAgICA+XG4gICAgICB7c3RhdGUgPT4gKFxuICAgICAgICA8ZGl2XG4gICAgICAgICAgcmVmPXt0cmFuc2l0aW9uUmVmfVxuICAgICAgICAgIGRhdGEtc3RhdGU9e3N0YXRlfVxuICAgICAgICAgIGNsYXNzTmFtZT17YW5pbWF0aW9uU3R5bGVzfVxuICAgICAgICAgIG9uTW91c2VFbnRlcj17aGFuZGxlTW91c2VFbnRlcn1cbiAgICAgICAgICBvbk1vdXNlTGVhdmU9e2hhbmRsZU1vdXNlTGVhdmV9XG4gICAgICAgICAgc3R5bGU9e3N0eWxlc31cbiAgICAgICAgPlxuICAgICAgICAgIDxCb3ggcmVmPXtvblJlZn0gcGFkZGluZz17OH0+XG4gICAgICAgICAgICA8QWxlcnRcbiAgICAgICAgICAgICAgZmxleFNocmluaz17MH1cbiAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cImNhcmRcIlxuICAgICAgICAgICAgICBlbGV2YXRpb249ezN9XG4gICAgICAgICAgICAgIGludGVudD17aW50ZW50fVxuICAgICAgICAgICAgICB0aXRsZT17dGl0bGV9XG4gICAgICAgICAgICAgIGlzUmVtb3ZlYWJsZT17aGFzQ2xvc2VCdXR0b259XG4gICAgICAgICAgICAgIG9uUmVtb3ZlPXtjbG9zZX1cbiAgICAgICAgICAgICAgcG9pbnRlckV2ZW50cz1cImFsbFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgIDwvQWxlcnQ+XG4gICAgICAgICAgPC9Cb3g+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKX1cbiAgICA8L1RyYW5zaXRpb24+XG4gIClcbn0pXG5cblRvYXN0LnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSB6LWluZGV4IG9mIHRoZSB0b2FzdC5cbiAgICovXG4gIHpJbmRleDogUHJvcFR5cGVzLm51bWJlcixcblxuICAvKipcbiAgICogRHVyYXRpb24gb2YgdGhlIHRvYXN0LlxuICAgKi9cbiAgZHVyYXRpb246IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSB0b2FzdCBpcyBhbGwgdGhlIHdheSBjbG9zZWQuXG4gICAqL1xuICBvblJlbW92ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSBhbGVydC5cbiAgICovXG4gIGludGVudDogUHJvcFR5cGVzLnN0cmluZyxcblxuICAvKipcbiAgICogVGhlIHRpdGxlIG9mIHRoZSBhbGVydC5cbiAgICovXG4gIHRpdGxlOiBQcm9wVHlwZXMubm9kZSxcblxuICAvKipcbiAgICogRGVzY3JpcHRpb24gb2YgdGhlIGFsZXJ0LlxuICAgKi9cbiAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIHNob3cgYSBjbG9zZSBpY29uIGJ1dHRvbiBpbnNpZGUgb2YgdGhlIHRvYXN0LlxuICAgKi9cbiAgaGFzQ2xvc2VCdXR0b246IFByb3BUeXBlcy5ib29sLFxuXG4gIC8qKlxuICAgKiBXaGVuIGZhbHNlLCB3aWxsIGNsb3NlIHRoZSBUb2FzdCBhbmQgY2FsbCBvblJlbW92ZSB3aGVuIGZpbmlzaGVkLlxuICAgKi9cbiAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2xcbn1cblxuZXhwb3J0IGRlZmF1bHQgVG9hc3RcbiJdfQ==