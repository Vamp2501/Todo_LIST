import _extends from "@babel/runtime/helpers/esm/extends";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
var _excluded = ["animationDuration", "bringFocusInside", "children", "content", "display", "minHeight", "minWidth", "onBodyClick", "onClose", "onCloseComplete", "onOpen", "onOpenComplete", "position", "shouldCloseOnExternalClick", "shouldCloseOnEscapePress", "statelessProps", "trigger"];

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import React, { memo, forwardRef, useRef, useState, useEffect, useImperativeHandle, useCallback, useMemo } from 'react';
import cx from 'classnames';
import { css as glamorCss } from 'glamor';
import PropTypes from 'prop-types';
import { Position } from '../../constants';
import { useMergedRef } from '../../hooks';
import { Positioner } from '../../positioner';
import { Tooltip } from '../../tooltip';
import PopoverStateless from './PopoverStateless';

var noop = function noop() {};

var emptyProps = {};
var Popover = /*#__PURE__*/memo( /*#__PURE__*/forwardRef(function Popover(_ref, forwardedRef) {
  var _ref$animationDuratio = _ref.animationDuration,
      animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,
      _ref$bringFocusInside = _ref.bringFocusInside,
      shouldBringFocusInside = _ref$bringFocusInside === void 0 ? false : _ref$bringFocusInside,
      children = _ref.children,
      content = _ref.content,
      display = _ref.display,
      _ref$minHeight = _ref.minHeight,
      minHeight = _ref$minHeight === void 0 ? 40 : _ref$minHeight,
      _ref$minWidth = _ref.minWidth,
      minWidth = _ref$minWidth === void 0 ? 200 : _ref$minWidth,
      _ref$onBodyClick = _ref.onBodyClick,
      onBodyClick = _ref$onBodyClick === void 0 ? noop : _ref$onBodyClick,
      _ref$onClose = _ref.onClose,
      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,
      _ref$onCloseComplete = _ref.onCloseComplete,
      onCloseComplete = _ref$onCloseComplete === void 0 ? noop : _ref$onCloseComplete,
      _ref$onOpen = _ref.onOpen,
      onOpen = _ref$onOpen === void 0 ? noop : _ref$onOpen,
      _ref$onOpenComplete = _ref.onOpenComplete,
      onOpenComplete = _ref$onOpenComplete === void 0 ? noop : _ref$onOpenComplete,
      _ref$position = _ref.position,
      position = _ref$position === void 0 ? Position.BOTTOM : _ref$position,
      _ref$shouldCloseOnExt = _ref.shouldCloseOnExternalClick,
      shouldCloseOnExternalClick = _ref$shouldCloseOnExt === void 0 ? true : _ref$shouldCloseOnExt,
      _ref$shouldCloseOnEsc = _ref.shouldCloseOnEscapePress,
      shouldCloseOnEscapePress = _ref$shouldCloseOnEsc === void 0 ? true : _ref$shouldCloseOnEsc,
      _ref$statelessProps = _ref.statelessProps,
      statelessProps = _ref$statelessProps === void 0 ? emptyProps : _ref$statelessProps,
      _ref$trigger = _ref.trigger,
      trigger = _ref$trigger === void 0 ? 'click' : _ref$trigger,
      props = _objectWithoutProperties(_ref, _excluded);

  var _useState = useState(props.isShown),
      _useState2 = _slicedToArray(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var popoverNode = useRef();
  var setPopoverNode = useMergedRef(popoverNode);
  var targetRef = useRef();
  var setTargetRef = useMergedRef(targetRef);
  useImperativeHandle(forwardedRef, function () {
    return {
      open: open,
      close: close
    };
  }, [popoverNode.current]);
  /**
   * Methods borrowed from BlueprintJS
   * https://github.com/palantir/blueprint/blob/release/2.0.0/packages/core/src/components/overlay/overlay.tsx
   */

  var bringFocusInside = useCallback(function (e) {
    if (isShown && e) {
      e.preventDefault();
    } // Always delay focus manipulation to just before repaint to prevent scroll jumping


    return requestAnimationFrame(function () {
      // Container ref may be undefined between component mounting and Portal rendering
      // ActiveElement may be undefined in some rare cases in IE
      if (popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null || // eslint-disable-line eqeqeq, no-eq-null
      !isShown) {
        return;
      }

      var isFocusOutsideModal = !popoverNode.current.contains(document.activeElement);

      if (isFocusOutsideModal) {
        // Element marked autofocus has higher priority than the other elements
        var autofocusElement = popoverNode.current.querySelector('[autofocus]:not([disabled])');

        if (autofocusElement) {
          // Return early to avoid unnecessary dom queries
          return autofocusElement.focus();
        }

        var wrapperElement = popoverNode.current.querySelector('[tabindex]:not([disabled])');

        if (wrapperElement) {
          return wrapperElement.focus();
        }

        var buttonElements = popoverNode.current.querySelectorAll('button:not([disabled]), a:not([disabled]), [role="menuitem"]:not([disabled]), [role="menuitemradio"]:not([disabled])');

        if (buttonElements.length > 0) {
          return buttonElements[0].focus();
        }
      }
    });
  }, [isShown, popoverNode.current]);
  var bringFocusBackToTarget = useCallback(function () {
    return requestAnimationFrame(function () {
      if (targetRef.current == null || // eslint-disable-line eqeqeq, no-eq-null
      popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null // eslint-disable-line eqeqeq, no-eq-null
      ) {
        return;
      }

      var isFocusInsideModal = popoverNode.current.contains(document.activeElement); // Bring back focus on the target.

      if (document.activeElement === document.body || isFocusInsideModal) {
        targetRef.current.focus();
      }
    });
  }, [popoverNode.current, targetRef.current]);
  var open = useCallback(function () {
    if (isShown) {
      return;
    }

    setIsShown(true);
    onOpen();
  }, [setIsShown, onOpen, isShown]);
  var close = useCallback(function () {
    if (!isShown) {
      return;
    }

    setIsShown(false);
    bringFocusBackToTarget();
    onClose();
  }, [setIsShown, bringFocusBackToTarget, onClose, isShown]); // If `props.isShown` is a boolean, treat as a controlled component
  // `open` and `close` should be applied when it changes

  useEffect(function () {
    if (typeof props.isShown !== 'boolean' || props.isShown === isShown) {
      return;
    }

    if (props.isShown) {
      open();
    } else {
      close();
    }
  }, [props.isShown, isShown]);
  var toggle = useCallback(function () {
    return isShown ? close() : open();
  }, [isShown, close, open]);
  var handleOpenHover = useMemo(function () {
    return trigger === 'hover' ? open : undefined;
  }, [trigger, open]);
  var handleCloseHover = useMemo(function () {
    return trigger === 'hover' ? close : undefined;
  }, [trigger, close]);
  var handleKeyDown = useCallback(function (event) {
    return event.key === 'ArrowDown' ? bringFocusInside(event) : undefined;
  }, [bringFocusInside]);
  var onEsc = useCallback(function (event) {
    return event.key === 'Escape' && shouldCloseOnEscapePress ? close() : undefined;
  }, [shouldCloseOnEscapePress, close]);
  var handleBodyClick = useCallback(function (event) {
    // Ignore clicks on the popover or button
    if (targetRef.current && targetRef.current.contains(event.target)) {
      return;
    }

    if (popoverNode.current && popoverNode.current.contains(event.target)) {
      return;
    } // Notify body click


    onBodyClick(event);

    if (shouldCloseOnExternalClick !== false) {
      close();
    }
  }, [onBodyClick, shouldCloseOnExternalClick, close, targetRef.current, popoverNode.current]);
  var handleOpenComplete = useCallback(function () {
    if (shouldBringFocusInside) bringFocusInside();
    onOpenComplete();
  }, [shouldBringFocusInside, bringFocusInside, onOpenComplete]);
  useEffect(function () {
    if (isShown) {
      document.body.addEventListener('click', handleBodyClick, false);
      document.body.addEventListener('keydown', onEsc, false);
    } else {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    }

    return function () {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    };
  }, [isShown, handleBodyClick, onEsc]);
  var renderTarget = useCallback(function (_ref2) {
    var getRef = _ref2.getRef,
        isShown = _ref2.isShown;
    var isTooltipInside = children && children.type === Tooltip;

    var getTargetRef = function getTargetRef(ref) {
      setTargetRef(ref);
      getRef(ref);
    };
    /**
     * When a function is passed, you can control the Popover manually.
     */


    if (typeof children === 'function') {
      return children({
        getRef: getTargetRef,
        isShown: isShown,
        toggle: toggle
      });
    }

    var popoverTargetProps = {
      onClick: toggle,
      onMouseEnter: handleOpenHover,
      onKeyDown: handleKeyDown,
      role: 'button',
      'aria-expanded': isShown,
      'aria-haspopup': true
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * In this case the children is the Tooltip instead of a button.
     * Pass the properties to the Tooltip and let the Tooltip
     * add the properties to the target.
     */

    if (isTooltipInside) {
      return /*#__PURE__*/React.cloneElement(children, {
        popoverProps: _objectSpread({
          getTargetRef: getTargetRef,
          isShown: isShown
        }, popoverTargetProps)
      });
    }
    /**
     * With normal usage only popover props end up on the target.
     */


    return /*#__PURE__*/React.cloneElement(children, _objectSpread({
      ref: getTargetRef
    }, popoverTargetProps));
  }, [children, setTargetRef, toggle, handleOpenHover, handleKeyDown]); // If `props.isShown` is a boolean, popover is controlled manually, not via mouse events

  var shown = typeof props.isShown === 'boolean' ? props.isShown : isShown;
  var contentToRender = useMemo(function () {
    return typeof content === 'function' ? content({
      close: close
    }) : content;
  }, [content, close]);
  return /*#__PURE__*/React.createElement(Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: animationDuration,
    onOpenComplete: handleOpenComplete,
    onCloseComplete: onCloseComplete
  }, function (_ref3) {
    var css = _ref3.css,
        getRef = _ref3.getRef,
        state = _ref3.state,
        style = _ref3.style;
    return /*#__PURE__*/React.createElement(PopoverStateless, _extends({
      ref: function ref(_ref4) {
        setPopoverNode(_ref4);
        getRef(_ref4);
      },
      "data-state": state,
      display: display,
      minWidth: minWidth,
      minHeight: minHeight
    }, statelessProps, {
      className: cx(statelessProps.className, glamorCss(css, style, statelessProps.style).toString()) // Overwrite `statelessProps.style` since we are including it via className
      ,
      style: undefined,
      onMouseLeave: handleCloseHover
    }), contentToRender);
  });
}));
Popover.propTypes = {
  /**
   * The position the Popover is on. Smart positioning might override this.
   */
  position: PropTypes.oneOf([Position.TOP, Position.TOP_LEFT, Position.TOP_RIGHT, Position.BOTTOM, Position.BOTTOM_LEFT, Position.BOTTOM_RIGHT, Position.LEFT, Position.RIGHT]),

  /**
   * When true, the Popover is manually shown.
   */
  isShown: PropTypes.bool,

  /**
   * Open the Popover based on click or hover. Default is click.
   */
  trigger: PropTypes.oneOf(['click', 'hover']),

  /**
   * The content of the Popover.
   */
  content: PropTypes.oneOfType([PropTypes.node, PropTypes.func]).isRequired,

  /**
   * The target button of the Popover.
   * When a function the following arguments are passed:
   * ({ toggle: Function -> Void, getRef: Function -> Ref, isShown: Bool })
   */
  children: PropTypes.oneOfType([PropTypes.element, PropTypes.func]).isRequired,

  /**
   * The display property passed to the Popover card.
   */
  display: PropTypes.string,

  /**
   * The min width of the Popover card.
   */
  minWidth: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),

  /**
   * The min height of the Popover card.
   */
  minHeight: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),

  /**
   * Properties passed through to the Popover card.
   */
  statelessProps: PropTypes.shape(PopoverStateless.propTypes),

  /**
   * Duration of the animation.
   */
  animationDuration: PropTypes.number,

  /**
   * Function called when the Popover opens.
   */
  onOpen: PropTypes.func,

  /**
   * Function fired when Popover closes.
   */
  onClose: PropTypes.func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: PropTypes.func,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: PropTypes.func,

  /**
   * Function that will be called when the body is clicked.
   */
  onBodyClick: PropTypes.func,

  /**
   * When true, bring focus inside of the Popover on open.
   */
  bringFocusInside: PropTypes.bool,

  /**
   * Boolean indicating if clicking outside the dialog should close the dialog.
   */
  shouldCloseOnExternalClick: PropTypes.bool,

  /**
   * Boolean indicating if pressing the esc key should close the dialog.
   */
  shouldCloseOnEscapePress: PropTypes.bool
};
export default Popover;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3BvdmVyL3NyYy9Qb3BvdmVyLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwibWVtbyIsImZvcndhcmRSZWYiLCJ1c2VSZWYiLCJ1c2VTdGF0ZSIsInVzZUVmZmVjdCIsInVzZUltcGVyYXRpdmVIYW5kbGUiLCJ1c2VDYWxsYmFjayIsInVzZU1lbW8iLCJjeCIsImNzcyIsImdsYW1vckNzcyIsIlByb3BUeXBlcyIsIlBvc2l0aW9uIiwidXNlTWVyZ2VkUmVmIiwiUG9zaXRpb25lciIsIlRvb2x0aXAiLCJQb3BvdmVyU3RhdGVsZXNzIiwibm9vcCIsImVtcHR5UHJvcHMiLCJQb3BvdmVyIiwiZm9yd2FyZGVkUmVmIiwiYW5pbWF0aW9uRHVyYXRpb24iLCJicmluZ0ZvY3VzSW5zaWRlIiwic2hvdWxkQnJpbmdGb2N1c0luc2lkZSIsImNoaWxkcmVuIiwiY29udGVudCIsImRpc3BsYXkiLCJtaW5IZWlnaHQiLCJtaW5XaWR0aCIsIm9uQm9keUNsaWNrIiwib25DbG9zZSIsIm9uQ2xvc2VDb21wbGV0ZSIsIm9uT3BlbiIsIm9uT3BlbkNvbXBsZXRlIiwicG9zaXRpb24iLCJCT1RUT00iLCJzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayIsInNob3VsZENsb3NlT25Fc2NhcGVQcmVzcyIsInN0YXRlbGVzc1Byb3BzIiwidHJpZ2dlciIsInByb3BzIiwiaXNTaG93biIsInNldElzU2hvd24iLCJwb3BvdmVyTm9kZSIsInNldFBvcG92ZXJOb2RlIiwidGFyZ2V0UmVmIiwic2V0VGFyZ2V0UmVmIiwib3BlbiIsImNsb3NlIiwiY3VycmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzRm9jdXNPdXRzaWRlTW9kYWwiLCJjb250YWlucyIsImF1dG9mb2N1c0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJ3cmFwcGVyRWxlbWVudCIsImJ1dHRvbkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImJyaW5nRm9jdXNCYWNrVG9UYXJnZXQiLCJpc0ZvY3VzSW5zaWRlTW9kYWwiLCJib2R5IiwidG9nZ2xlIiwiaGFuZGxlT3BlbkhvdmVyIiwidW5kZWZpbmVkIiwiaGFuZGxlQ2xvc2VIb3ZlciIsImhhbmRsZUtleURvd24iLCJldmVudCIsImtleSIsIm9uRXNjIiwiaGFuZGxlQm9keUNsaWNrIiwidGFyZ2V0IiwiaGFuZGxlT3BlbkNvbXBsZXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJpc1Rvb2x0aXBJbnNpZGUiLCJ0eXBlIiwiZ2V0VGFyZ2V0UmVmIiwicmVmIiwicG9wb3ZlclRhcmdldFByb3BzIiwib25DbGljayIsIm9uTW91c2VFbnRlciIsIm9uS2V5RG93biIsInJvbGUiLCJjbG9uZUVsZW1lbnQiLCJwb3BvdmVyUHJvcHMiLCJzaG93biIsImNvbnRlbnRUb1JlbmRlciIsInN0YXRlIiwic3R5bGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsImJvb2wiLCJvbmVPZlR5cGUiLCJub2RlIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJlbGVtZW50Iiwic3RyaW5nIiwibnVtYmVyIiwic2hhcGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPQSxLQUFQLElBQWdCQyxJQUFoQixFQUFzQkMsVUFBdEIsRUFBa0NDLE1BQWxDLEVBQTBDQyxRQUExQyxFQUFvREMsU0FBcEQsRUFBK0RDLG1CQUEvRCxFQUFvRkMsV0FBcEYsRUFBaUdDLE9BQWpHLFFBQWdILE9BQWhIO0FBQ0EsT0FBT0MsRUFBUCxNQUFlLFlBQWY7QUFDQSxTQUFTQyxHQUFHLElBQUlDLFNBQWhCLFFBQWlDLFFB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QixDQUFwQixDQTVDUTs7QUE4Q2xCO0FBQ0Y7QUFDQTtBQUNFdkYsRUFBQUEsU0FBUyxFQUFFaEIsU0FBUyxDQUFDa0csU0FBVixDQUFvQixDQUFDbEcsU0FBUyxDQUFDd0csTUFBWCxFQUFtQnhHLFNBQVMsQ0FBQ3VHLE1BQTdCLENBQXBCLENBakRPOztBQW1EbEI7QUFDRjtBQUNBO0FBQ0U1RSxFQUFBQSxjQUFjLEVBQUUzQixTQUFTLENBQUN5RyxLQUFWLENBQWdCcEcsZ0JBQWdCLENBQUNtRixTQUFqQyxDQXRERTs7QUF3RGxCO0FBQ0Y7QUFDQTtBQUNFOUUsRUFBQUEsaUJBQWlCLEVBQUVWLFNBQVMsQ0FBQ3dHLE1BM0RYOztBQTZEbEI7QUFDRjtBQUNBO0FBQ0VuRixFQUFBQSxNQUFNLEVBQUVyQixTQUFTLENBQUNvRyxJQWhFQTs7QUFrRWxCO0FBQ0Y7QUFDQTtBQUNFakYsRUFBQUEsT0FBTyxFQUFFbkIsU0FBUyxDQUFDb0csSUFyRUQ7O0FBdUVsQjtBQUNGO0FBQ0E7QUFDRTlFLEVBQUFBLGNBQWMsRUFBRXRCLFNBQVMsQ0FBQ29HLElBMUVSOztBQTRFbEI7QUFDRjtBQUNBO0FBQ0VoRixFQUFBQSxlQUFlLEVBQUVwQixTQUFTLENBQUNvRyxJQS9FVDs7QUFpRmxCO0FBQ0Y7QUFDQTtBQUNFbEYsRUFBQUEsV0FBVyxFQUFFbEIsU0FBUyxDQUFDb0csSUFwRkw7O0FBc0ZsQjtBQUNGO0FBQ0E7QUFDRXpGLEVBQUFBLGdCQUFnQixFQUFFWCxTQUFTLENBQUNpRyxJQXpGVjs7QUEyRmxCO0FBQ0Y7QUFDQTtBQUNFeEUsRUFBQUEsMEJBQTBCLEVBQUV6QixTQUFTLENBQUNpRyxJQTlGcEI7O0FBZ0dsQjtBQUNGO0FBQ0E7QUFDRXZFLEVBQUFBLHdCQUF3QixFQUFFMUIsU0FBUyxDQUFDaUc7QUFuR2xCLENBQXBCO0FBc0dBLGVBQWV6RixPQUFmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IG1lbW8sIGZvcndhcmRSZWYsIHVzZVJlZiwgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlSW1wZXJhdGl2ZUhhbmRsZSwgdXNlQ2FsbGJhY2ssIHVzZU1lbW8gfSBmcm9tICdyZWFjdCdcbmltcG9ydCBjeCBmcm9tICdjbGFzc25hbWVzJ1xuaW1wb3J0IHsgY3NzIGFzIGdsYW1vckNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCB7IFBvc2l0aW9uIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzJ1xuaW1wb3J0IHsgdXNlTWVyZ2VkUmVmIH0gZnJvbSAnLi4vLi4vaG9va3MnXG5pbXBvcnQgeyBQb3NpdGlvbmVyIH0gZnJvbSAnLi4vLi4vcG9zaXRpb25lcidcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICcuLi8uLi90b29sdGlwJ1xuaW1wb3J0IFBvcG92ZXJTdGF0ZWxlc3MgZnJvbSAnLi9Qb3BvdmVyU3RhdGVsZXNzJ1xuXG5jb25zdCBub29wID0gKCkgPT4ge31cbmNvbnN0IGVtcHR5UHJvcHMgPSB7fVxuXG5jb25zdCBQb3BvdmVyID0gbWVtbyhcbiAgZm9yd2FyZFJlZihmdW5jdGlvbiBQb3BvdmVyKFxuICAgIHtcbiAgICAgIGFuaW1hdGlvbkR1cmF0aW9uID0gMzAwLFxuICAgICAgYnJpbmdGb2N1c0luc2lkZTogc2hvdWxkQnJpbmdGb2N1c0luc2lkZSA9IGZhbHNlLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBjb250ZW50LFxuICAgICAgZGlzcGxheSxcbiAgICAgIG1pbkhlaWdodCA9IDQwLFxuICAgICAgbWluV2lkdGggPSAyMDAsXG4gICAgICBvbkJvZHlDbGljayA9IG5vb3AsXG4gICAgICBvbkNsb3NlID0gbm9vcCxcbiAgICAgIG9uQ2xvc2VDb21wbGV0ZSA9IG5vb3AsXG4gICAgICBvbk9wZW4gPSBub29wLFxuICAgICAgb25PcGVuQ29tcGxldGUgPSBub29wLFxuICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5CT1RUT00sXG4gICAgICBzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayA9IHRydWUsXG4gICAgICBzaG91bGRDbG9zZU9uRXNjYXBlUHJlc3MgPSB0cnVlLFxuICAgICAgc3RhdGVsZXNzUHJvcHMgPSBlbXB0eVByb3BzLFxuICAgICAgdHJpZ2dlciA9ICdjbGljaycsXG4gICAgICAuLi5wcm9wc1xuICAgIH0sXG4gICAgZm9yd2FyZGVkUmVmXG4gICkge1xuICAgIGNvbnN0IFtpc1Nob3duLCBzZXRJc1Nob3duXSA9IHVzZVN0YXRlKHByb3BzLmlzU2hvd24pXG4gICAgY29uc3QgcG9wb3Zlck5vZGUgPSB1c2VSZWYoKVxuICAgIGNvbnN0IHNldFBvcG92ZXJOb2RlID0gdXNlTWVyZ2VkUmVmKHBvcG92ZXJOb2RlKVxuICAgIGNvbnN0IHRhcmdldFJlZiA9IHVzZVJlZigpXG4gICAgY29uc3Qgc2V0VGFyZ2V0UmVmID0gdXNlTWVyZ2VkUmVmKHRhcmdldFJlZilcblxuICAgIHVzZUltcGVyYXRpdmVIYW5kbGUoXG4gICAgICBmb3J3YXJkZWRSZWYsXG4gICAgICAoKSA9PiAoe1xuICAgICAgICBvcGVuLFxuICAgICAgICBjbG9zZVxuICAgICAgfSksXG4gICAgICBbcG9wb3Zlck5vZGUuY3VycmVudF1cbiAgICApXG5cbiAgICAvKipcbiAgICAgKiBNZXRob2RzIGJvcnJvd2VkIGZyb20gQmx1ZXByaW50SlNcbiAgICAgKiBodHRwczovL2dpdGh1Yi5jb20vcGFsYW50aXIvYmx1ZXByaW50L2Jsb2IvcmVsZWFzZS8yLjAuMC9wYWNrYWdlcy9jb3JlL3NyYy9jb21wb25lbnRzL292ZXJsYXkvb3ZlcmxheS50c3hcbiAgICAgKi9cbiAgICBjb25zdCBicmluZ0ZvY3VzSW5zaWRlID0gdXNlQ2FsbGJhY2soXG4gICAgICBlID0+IHtcbiAgICAgICAgaWYgKGlzU2hvd24gJiYgZSkge1xuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICB9XG4gICAgICAgIC8vIEFsd2F5cyBkZWxheSBmb2N1cyBtYW5pcHVsYXRpb24gdG8ganVzdCBiZWZvcmUgcmVwYWludCB0byBwcmV2ZW50IHNjcm9sbCBqdW1waW5nXG5cbiAgICAgICAgcmV0dXJuIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgLy8gQ29udGFpbmVyIHJlZiBtYXkgYmUgdW5kZWZpbmVkIGJldHdlZW4gY29tcG9uZW50IG1vdW50aW5nIGFuZCBQb3J0YWwgcmVuZGVyaW5nXG5cbiAgICAgICAgICAvLyBBY3RpdmVFbGVtZW50IG1heSBiZSB1bmRlZmluZWQgaW4gc29tZSByYXJlIGNhc2VzIGluIElFXG5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwb3BvdmVyTm9kZS5jdXJyZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgICAgIWlzU2hvd25cbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGlzRm9jdXNPdXRzaWRlTW9kYWwgPSAhcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KVxuICAgICAgICAgIGlmIChpc0ZvY3VzT3V0c2lkZU1vZGFsKSB7XG4gICAgICAgICAgICAvLyBFbGVtZW50IG1hcmtlZCBhdXRvZm9jdXMgaGFzIGhpZ2hlciBwcmlvcml0eSB0aGFuIHRoZSBvdGhlciBlbGVtZW50c1xuICAgICAgICAgICAgY29uc3QgYXV0b2ZvY3VzRWxlbWVudCA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvcignW2F1dG9mb2N1c106bm90KFtkaXNhYmxlZF0pJylcbiAgICAgICAgICAgIGlmIChhdXRvZm9jdXNFbGVtZW50KSB7XG4gICAgICAgICAgICAgIC8vIFJldHVybiBlYXJseSB0byBhdm9pZCB1bm5lY2Vzc2FyeSBkb20gcXVlcmllc1xuICAgICAgICAgICAgICByZXR1cm4gYXV0b2ZvY3VzRWxlbWVudC5mb2N1cygpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHdyYXBwZXJFbGVtZW50ID0gcG9wb3Zlck5vZGUuY3VycmVudC5xdWVyeVNlbGVjdG9yKCdbdGFiaW5kZXhdOm5vdChbZGlzYWJsZWRdKScpXG4gICAgICAgICAgICBpZiAod3JhcHBlckVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHdyYXBwZXJFbGVtZW50LmZvY3VzKClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgYnV0dG9uRWxlbWVudHMgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICAgICAgICAgICdidXR0b246bm90KFtkaXNhYmxlZF0pLCBhOm5vdChbZGlzYWJsZWRdKSwgW3JvbGU9XCJtZW51aXRlbVwiXTpub3QoW2Rpc2FibGVkXSksIFtyb2xlPVwibWVudWl0ZW1yYWRpb1wiXTpub3QoW2Rpc2FibGVkXSknXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBpZiAoYnV0dG9uRWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uRWxlbWVudHNbMF0uZm9jdXMoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBbaXNTaG93biwgcG9wb3Zlck5vZGUuY3VycmVudF1cbiAgICApXG5cbiAgICBjb25zdCBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgcmV0dXJuIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0YXJnZXRSZWYuY3VycmVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgcG9wb3Zlck5vZGUuY3VycmVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PSBudWxsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaXNGb2N1c0luc2lkZU1vZGFsID0gcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhkb2N1bWVudC5hY3RpdmVFbGVtZW50KVxuXG4gICAgICAgIC8vIEJyaW5nIGJhY2sgZm9jdXMgb24gdGhlIHRhcmdldC5cbiAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IGRvY3VtZW50LmJvZHkgfHwgaXNGb2N1c0luc2lkZU1vZGFsKSB7XG4gICAgICAgICAgdGFyZ2V0UmVmLmN1cnJlbnQuZm9jdXMoKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sIFtwb3BvdmVyTm9kZS5jdXJyZW50LCB0YXJnZXRSZWYuY3VycmVudF0pXG5cbiAgICBjb25zdCBvcGVuID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKGlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHNldElzU2hvd24odHJ1ZSlcbiAgICAgIG9uT3BlbigpXG4gICAgfSwgW3NldElzU2hvd24sIG9uT3BlbiwgaXNTaG93bl0pXG5cbiAgICBjb25zdCBjbG9zZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmICghaXNTaG93bikge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgc2V0SXNTaG93bihmYWxzZSlcbiAgICAgIGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQoKVxuICAgICAgb25DbG9zZSgpXG4gICAgfSwgW3NldElzU2hvd24sIGJyaW5nRm9jdXNCYWNrVG9UYXJnZXQsIG9uQ2xvc2UsIGlzU2hvd25dKVxuXG4gICAgLy8gSWYgYHByb3BzLmlzU2hvd25gIGlzIGEgYm9vbGVhbiwgdHJlYXQgYXMgYSBjb250cm9sbGVkIGNvbXBvbmVudFxuICAgIC8vIGBvcGVuYCBhbmQgYGNsb3NlYCBzaG91bGQgYmUgYXBwbGllZCB3aGVuIGl0IGNoYW5nZXNcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBwcm9wcy5pc1Nob3duICE9PSAnYm9vbGVhbicgfHwgcHJvcHMuaXNTaG93biA9PT0gaXNTaG93bikge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgaWYgKHByb3BzLmlzU2hvd24pIHtcbiAgICAgICAgb3BlbigpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjbG9zZSgpXG4gICAgICB9XG4gICAgfSwgW3Byb3BzLmlzU2hvd24sIGlzU2hvd25dKVxuXG4gICAgY29uc3QgdG9nZ2xlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgcmV0dXJuIGlzU2hvd24gPyBjbG9zZSgpIDogb3BlbigpXG4gICAgfSwgW2lzU2hvd24sIGNsb3NlLCBvcGVuXSlcblxuICAgIGNvbnN0IGhhbmRsZU9wZW5Ib3ZlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHRyaWdnZXIgPT09ICdob3ZlcicgPyBvcGVuIDogdW5kZWZpbmVkXG4gICAgfSwgW3RyaWdnZXIsIG9wZW5dKVxuXG4gICAgY29uc3QgaGFuZGxlQ2xvc2VIb3ZlciA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgcmV0dXJuIHRyaWdnZXIgPT09ICdob3ZlcicgPyBjbG9zZSA6IHVuZGVmaW5lZFxuICAgIH0sIFt0cmlnZ2VyLCBjbG9zZV0pXG5cbiAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gdXNlQ2FsbGJhY2soXG4gICAgICBldmVudCA9PiB7XG4gICAgICAgIHJldHVybiBldmVudC5rZXkgPT09ICdBcnJvd0Rvd24nID8gYnJpbmdGb2N1c0luc2lkZShldmVudCkgOiB1bmRlZmluZWRcbiAgICAgIH0sXG4gICAgICBbYnJpbmdGb2N1c0luc2lkZV1cbiAgICApXG5cbiAgICBjb25zdCBvbkVzYyA9IHVzZUNhbGxiYWNrKFxuICAgICAgZXZlbnQgPT4ge1xuICAgICAgICByZXR1cm4gZXZlbnQua2V5ID09PSAnRXNjYXBlJyAmJiBzaG91bGRDbG9zZU9uRXNjYXBlUHJlc3MgPyBjbG9zZSgpIDogdW5kZWZpbmVkXG4gICAgICB9LFxuICAgICAgW3Nob3VsZENsb3NlT25Fc2NhcGVQcmVzcywgY2xvc2VdXG4gICAgKVxuXG4gICAgY29uc3QgaGFuZGxlQm9keUNsaWNrID0gdXNlQ2FsbGJhY2soXG4gICAgICBldmVudCA9PiB7XG4gICAgICAgIC8vIElnbm9yZSBjbGlja3Mgb24gdGhlIHBvcG92ZXIgb3IgYnV0dG9uXG4gICAgICAgIGlmICh0YXJnZXRSZWYuY3VycmVudCAmJiB0YXJnZXRSZWYuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAocG9wb3Zlck5vZGUuY3VycmVudCAmJiBwb3BvdmVyTm9kZS5jdXJyZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdGlmeSBib2R5IGNsaWNrXG4gICAgICAgIG9uQm9keUNsaWNrKGV2ZW50KVxuXG4gICAgICAgIGlmIChzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayAhPT0gZmFsc2UpIHtcbiAgICAgICAgICBjbG9zZSgpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbb25Cb2R5Q2xpY2ssIHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrLCBjbG9zZSwgdGFyZ2V0UmVmLmN1cnJlbnQsIHBvcG92ZXJOb2RlLmN1cnJlbnRdXG4gICAgKVxuXG4gICAgY29uc3QgaGFuZGxlT3BlbkNvbXBsZXRlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKHNob3VsZEJyaW5nRm9jdXNJbnNpZGUpIGJyaW5nRm9jdXNJbnNpZGUoKVxuICAgICAgb25PcGVuQ29tcGxldGUoKVxuICAgIH0sIFtzaG91bGRCcmluZ0ZvY3VzSW5zaWRlLCBicmluZ0ZvY3VzSW5zaWRlLCBvbk9wZW5Db21wbGV0ZV0pXG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgaWYgKGlzU2hvd24pIHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJvZHlDbGljaywgZmFsc2UpXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uRXNjLCBmYWxzZSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVCb2R5Q2xpY2ssIGZhbHNlKVxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkVzYywgZmFsc2UpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVCb2R5Q2xpY2ssIGZhbHNlKVxuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkVzYywgZmFsc2UpXG4gICAgICB9XG4gICAgfSwgW2lzU2hvd24sIGhhbmRsZUJvZHlDbGljaywgb25Fc2NdKVxuXG4gICAgY29uc3QgcmVuZGVyVGFyZ2V0ID0gdXNlQ2FsbGJhY2soXG4gICAgICAoeyBnZXRSZWYsIGlzU2hvd24gfSkgPT4ge1xuICAgICAgICBjb25zdCBpc1Rvb2x0aXBJbnNpZGUgPSBjaGlsZHJlbiAmJiBjaGlsZHJlbi50eXBlID09PSBUb29sdGlwXG5cbiAgICAgICAgY29uc3QgZ2V0VGFyZ2V0UmVmID0gcmVmID0+IHtcbiAgICAgICAgICBzZXRUYXJnZXRSZWYocmVmKVxuICAgICAgICAgIGdldFJlZihyZWYpXG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogV2hlbiBhIGZ1bmN0aW9uIGlzIHBhc3NlZCwgeW91IGNhbiBjb250cm9sIHRoZSBQb3BvdmVyIG1hbnVhbGx5LlxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKHR5cGVvZiBjaGlsZHJlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHJldHVybiBjaGlsZHJlbih7XG4gICAgICAgICAgICBnZXRSZWY6IGdldFRhcmdldFJlZixcbiAgICAgICAgICAgIGlzU2hvd24sXG4gICAgICAgICAgICB0b2dnbGVcbiAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcG9wb3ZlclRhcmdldFByb3BzID0ge1xuICAgICAgICAgIG9uQ2xpY2s6IHRvZ2dsZSxcbiAgICAgICAgICBvbk1vdXNlRW50ZXI6IGhhbmRsZU9wZW5Ib3ZlcixcbiAgICAgICAgICBvbktleURvd246IGhhbmRsZUtleURvd24sXG4gICAgICAgICAgcm9sZTogJ2J1dHRvbicsXG4gICAgICAgICAgJ2FyaWEtZXhwYW5kZWQnOiBpc1Nob3duLFxuICAgICAgICAgICdhcmlhLWhhc3BvcHVwJzogdHJ1ZVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRvb2x0aXBzIGNhbiBiZSB1c2VkIHdpdGhpbiBhIFBvcG92ZXIgKG5vdCB0aGUgb3RoZXIgd2F5IGFyb3VuZClcbiAgICAgICAgICogSW4gdGhpcyBjYXNlIHRoZSBjaGlsZHJlbiBpcyB0aGUgVG9vbHRpcCBpbnN0ZWFkIG9mIGEgYnV0dG9uLlxuICAgICAgICAgKiBQYXNzIHRoZSBwcm9wZXJ0aWVzIHRvIHRoZSBUb29sdGlwIGFuZCBsZXQgdGhlIFRvb2x0aXBcbiAgICAgICAgICogYWRkIHRoZSBwcm9wZXJ0aWVzIHRvIHRoZSB0YXJnZXQuXG4gICAgICAgICAqL1xuICAgICAgICBpZiAoaXNUb29sdGlwSW5zaWRlKSB7XG4gICAgICAgICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChjaGlsZHJlbiwge1xuICAgICAgICAgICAgcG9wb3ZlclByb3BzOiB7XG4gICAgICAgICAgICAgIGdldFRhcmdldFJlZixcbiAgICAgICAgICAgICAgaXNTaG93bixcblxuICAgICAgICAgICAgICAvLyBUaGVzZSBwcm9wZXRpZXMgd2lsbCBiZSBzcHJlYWQgYXMgYHBvcG92ZXJUYXJnZXRQcm9wc2BcbiAgICAgICAgICAgICAgLy8gaW4gdGhlIFRvb2x0aXAgY29tcG9uZW50LlxuICAgICAgICAgICAgICAuLi5wb3BvdmVyVGFyZ2V0UHJvcHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdpdGggbm9ybWFsIHVzYWdlIG9ubHkgcG9wb3ZlciBwcm9wcyBlbmQgdXAgb24gdGhlIHRhcmdldC5cbiAgICAgICAgICovXG4gICAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgICByZWY6IGdldFRhcmdldFJlZixcbiAgICAgICAgICAuLi5wb3BvdmVyVGFyZ2V0UHJvcHNcbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBbY2hpbGRyZW4sIHNldFRhcmdldFJlZiwgdG9nZ2xlLCBoYW5kbGVPcGVuSG92ZXIsIGhhbmRsZUtleURvd25dXG4gICAgKVxuXG4gICAgLy8gSWYgYHByb3BzLmlzU2hvd25gIGlzIGEgYm9vbGVhbiwgcG9wb3ZlciBpcyBjb250cm9sbGVkIG1hbnVhbGx5LCBub3QgdmlhIG1vdXNlIGV2ZW50c1xuICAgIGNvbnN0IHNob3duID0gdHlwZW9mIHByb3BzLmlzU2hvd24gPT09ICdib29sZWFuJyA/IHByb3BzLmlzU2hvd24gOiBpc1Nob3duXG5cbiAgICBjb25zdCBjb250ZW50VG9SZW5kZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0eXBlb2YgY29udGVudCA9PT0gJ2Z1bmN0aW9uJyA/IGNvbnRlbnQoeyBjbG9zZSB9KSA6IGNvbnRlbnRcbiAgICB9LCBbY29udGVudCwgY2xvc2VdKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxQb3NpdGlvbmVyXG4gICAgICAgIHRhcmdldD17cmVuZGVyVGFyZ2V0fVxuICAgICAgICBpc1Nob3duPXtzaG93bn1cbiAgICAgICAgcG9zaXRpb249e3Bvc2l0aW9ufVxuICAgICAgICBhbmltYXRpb25EdXJhdGlvbj17YW5pbWF0aW9uRHVyYXRpb259XG4gICAgICAgIG9uT3BlbkNvbXBsZXRlPXtoYW5kbGVPcGVuQ29tcGxldGV9XG4gICAgICAgIG9uQ2xvc2VDb21wbGV0ZT17b25DbG9zZUNvbXBsZXRlfVxuICAgICAgPlxuICAgICAgICB7KHsgY3NzLCBnZXRSZWYsIHN0YXRlLCBzdHlsZSB9KSA9PiAoXG4gICAgICAgICAgPFBvcG92ZXJTdGF0ZWxlc3NcbiAgICAgICAgICAgIHJlZj17cmVmID0+IHtcbiAgICAgICAgICAgICAgc2V0UG9wb3Zlck5vZGUocmVmKVxuICAgICAgICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIGRhdGEtc3RhdGU9e3N0YXRlfVxuICAgICAgICAgICAgZGlzcGxheT17ZGlzcGxheX1cbiAgICAgICAgICAgIG1pbldpZHRoPXttaW5XaWR0aH1cbiAgICAgICAgICAgIG1pbkhlaWdodD17bWluSGVpZ2h0fVxuICAgICAgICAgICAgey4uLnN0YXRlbGVzc1Byb3BzfVxuICAgICAgICAgICAgY2xhc3NOYW1lPXtjeChzdGF0ZWxlc3NQcm9wcy5jbGFzc05hbWUsIGdsYW1vckNzcyhjc3MsIHN0eWxlLCBzdGF0ZWxlc3NQcm9wcy5zdHlsZSkudG9TdHJpbmcoKSl9XG4gICAgICAgICAgICAvLyBPdmVyd3JpdGUgYHN0YXRlbGVzc1Byb3BzLnN0eWxlYCBzaW5jZSB3ZSBhcmUgaW5jbHVkaW5nIGl0IHZpYSBjbGFzc05hbWVcbiAgICAgICAgICAgIHN0eWxlPXt1bmRlZmluZWR9XG4gICAgICAgICAgICBvbk1vdXNlTGVhdmU9e2hhbmRsZUNsb3NlSG92ZXJ9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2NvbnRlbnRUb1JlbmRlcn1cbiAgICAgICAgICA8L1BvcG92ZXJTdGF0ZWxlc3M+XG4gICAgICAgICl9XG4gICAgICA8L1Bvc2l0aW9uZXI+XG4gICAgKVxuICB9KVxuKVxuXG5Qb3BvdmVyLnByb3BUeXBlcyA9IHtcbiAgLyoqXG4gICAqIFRoZSBwb3NpdGlvbiB0aGUgUG9wb3ZlciBpcyBvbi4gU21hcnQgcG9zaXRpb25pbmcgbWlnaHQgb3ZlcnJpZGUgdGhpcy5cbiAgICovXG4gIHBvc2l0aW9uOiBQcm9wVHlwZXMub25lT2YoW1xuICAgIFBvc2l0aW9uLlRPUCxcbiAgICBQb3NpdGlvbi5UT1BfTEVGVCxcbiAgICBQb3NpdGlvbi5UT1BfUklHSFQsXG4gICAgUG9zaXRpb24uQk9UVE9NLFxuICAgIFBvc2l0aW9uLkJPVFRPTV9MRUZULFxuICAgIFBvc2l0aW9uLkJPVFRPTV9SSUdIVCxcbiAgICBQb3NpdGlvbi5MRUZULFxuICAgIFBvc2l0aW9uLlJJR0hUXG4gIF0pLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIHRoZSBQb3BvdmVyIGlzIG1hbnVhbGx5IHNob3duLlxuICAgKi9cbiAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2wsXG4gIC8qKlxuICAgKiBPcGVuIHRoZSBQb3BvdmVyIGJhc2VkIG9uIGNsaWNrIG9yIGhvdmVyLiBEZWZhdWx0IGlzIGNsaWNrLlxuICAgKi9cbiAgdHJpZ2dlcjogUHJvcFR5cGVzLm9uZU9mKFsnY2xpY2snLCAnaG92ZXInXSksXG5cbiAgLyoqXG4gICAqIFRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyLlxuICAgKi9cbiAgY29udGVudDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSkuaXNSZXF1aXJlZCxcblxuICAvKipcbiAgICogVGhlIHRhcmdldCBidXR0b24gb2YgdGhlIFBvcG92ZXIuXG4gICAqIFdoZW4gYSBmdW5jdGlvbiB0aGUgZm9sbG93aW5nIGFyZ3VtZW50cyBhcmUgcGFzc2VkOlxuICAgKiAoeyB0b2dnbGU6IEZ1bmN0aW9uIC0+IFZvaWQsIGdldFJlZjogRnVuY3Rpb24gLT4gUmVmLCBpc1Nob3duOiBCb29sIH0pXG4gICAqL1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLmVsZW1lbnQsIFByb3BUeXBlcy5mdW5jXSkuaXNSZXF1aXJlZCxcblxuICAvKipcbiAgICogVGhlIGRpc3BsYXkgcHJvcGVydHkgcGFzc2VkIHRvIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBkaXNwbGF5OiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gIC8qKlxuICAgKiBUaGUgbWluIHdpZHRoIG9mIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBtaW5XaWR0aDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm51bWJlciwgUHJvcFR5cGVzLnN0cmluZ10pLFxuXG4gIC8qKlxuICAgKiBUaGUgbWluIGhlaWdodCBvZiB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgbWluSGVpZ2h0OiBQcm9wVHlwZXMub25lT2ZUeXBlKFtQcm9wVHlwZXMubnVtYmVyLCBQcm9wVHlwZXMuc3RyaW5nXSksXG5cbiAgLyoqXG4gICAqIFByb3BlcnRpZXMgcGFzc2VkIHRocm91Z2ggdG8gdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIHN0YXRlbGVzc1Byb3BzOiBQcm9wVHlwZXMuc2hhcGUoUG9wb3ZlclN0YXRlbGVzcy5wcm9wVHlwZXMpLFxuXG4gIC8qKlxuICAgKiBEdXJhdGlvbiBvZiB0aGUgYW5pbWF0aW9uLlxuICAgKi9cbiAgYW5pbWF0aW9uRHVyYXRpb246IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHRoZSBQb3BvdmVyIG9wZW5zLlxuICAgKi9cbiAgb25PcGVuOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gZmlyZWQgd2hlbiBQb3BvdmVyIGNsb3Nlcy5cbiAgICovXG4gIG9uQ2xvc2U6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGVudGVyIHRyYW5zaXRpb24gaXMgY29tcGxldGUuXG4gICAqL1xuICBvbk9wZW5Db21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgZXhpdCB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlLlxuICAgKi9cbiAgb25DbG9zZUNvbXBsZXRlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBib2R5IGlzIGNsaWNrZWQuXG4gICAqL1xuICBvbkJvZHlDbGljazogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIFdoZW4gdHJ1ZSwgYnJpbmcgZm9jdXMgaW5zaWRlIG9mIHRoZSBQb3BvdmVyIG9uIG9wZW4uXG4gICAqL1xuICBicmluZ0ZvY3VzSW5zaWRlOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvKipcbiAgICogQm9vbGVhbiBpbmRpY2F0aW5nIGlmIGNsaWNraW5nIG91dHNpZGUgdGhlIGRpYWxvZyBzaG91bGQgY2xvc2UgdGhlIGRpYWxvZy5cbiAgICovXG4gIHNob3VsZENsb3NlT25FeHRlcm5hbENsaWNrOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvKipcbiAgICogQm9vbGVhbiBpbmRpY2F0aW5nIGlmIHByZXNzaW5nIHRoZSBlc2Mga2V5IHNob3VsZCBjbG9zZSB0aGUgZGlhbG9nLlxuICAgKi9cbiAgc2hvdWxkQ2xvc2VPbkVzY2FwZVByZXNzOiBQcm9wVHlwZXMuYm9vbFxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3BvdmVyXG4iXX0=