"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _classnames = _interopRequireDefault(require("classnames"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _constants = require("../../constants");

var _hooks = require("../../hooks");

var _positioner = require("../../positioner");

var _tooltip = require("../../tooltip");

var _PopoverStateless = _interopRequireDefault(require("./PopoverStateless"));

var _excluded = ["animationDuration", "bringFocusInside", "children", "content", "display", "minHeight", "minWidth", "onBodyClick", "onClose", "onCloseComplete", "onOpen", "onOpenComplete", "position", "shouldCloseOnExternalClick", "shouldCloseOnEscapePress", "statelessProps", "trigger"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { "default": obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj["default"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var noop = function noop() {};

var emptyProps = {};
var Popover = /*#__PURE__*/(0, _react.memo)( /*#__PURE__*/(0, _react.forwardRef)(function Popover(_ref, forwardedRef) {
  var _ref$animationDuratio = _ref.animationDuration,
      animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,
      _ref$bringFocusInside = _ref.bringFocusInside,
      shouldBringFocusInside = _ref$bringFocusInside === void 0 ? false : _ref$bringFocusInside,
      children = _ref.children,
      content = _ref.content,
      display = _ref.display,
      _ref$minHeight = _ref.minHeight,
      minHeight = _ref$minHeight === void 0 ? 40 : _ref$minHeight,
      _ref$minWidth = _ref.minWidth,
      minWidth = _ref$minWidth === void 0 ? 200 : _ref$minWidth,
      _ref$onBodyClick = _ref.onBodyClick,
      onBodyClick = _ref$onBodyClick === void 0 ? noop : _ref$onBodyClick,
      _ref$onClose = _ref.onClose,
      onClose = _ref$onClose === void 0 ? noop : _ref$onClose,
      _ref$onCloseComplete = _ref.onCloseComplete,
      onCloseComplete = _ref$onCloseComplete === void 0 ? noop : _ref$onCloseComplete,
      _ref$onOpen = _ref.onOpen,
      onOpen = _ref$onOpen === void 0 ? noop : _ref$onOpen,
      _ref$onOpenComplete = _ref.onOpenComplete,
      onOpenComplete = _ref$onOpenComplete === void 0 ? noop : _ref$onOpenComplete,
      _ref$position = _ref.position,
      position = _ref$position === void 0 ? _constants.Position.BOTTOM : _ref$position,
      _ref$shouldCloseOnExt = _ref.shouldCloseOnExternalClick,
      shouldCloseOnExternalClick = _ref$shouldCloseOnExt === void 0 ? true : _ref$shouldCloseOnExt,
      _ref$shouldCloseOnEsc = _ref.shouldCloseOnEscapePress,
      shouldCloseOnEscapePress = _ref$shouldCloseOnEsc === void 0 ? true : _ref$shouldCloseOnEsc,
      _ref$statelessProps = _ref.statelessProps,
      statelessProps = _ref$statelessProps === void 0 ? emptyProps : _ref$statelessProps,
      _ref$trigger = _ref.trigger,
      trigger = _ref$trigger === void 0 ? 'click' : _ref$trigger,
      props = (0, _objectWithoutProperties2["default"])(_ref, _excluded);

  var _useState = (0, _react.useState)(props.isShown),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      isShown = _useState2[0],
      setIsShown = _useState2[1];

  var popoverNode = (0, _react.useRef)();
  var setPopoverNode = (0, _hooks.useMergedRef)(popoverNode);
  var targetRef = (0, _react.useRef)();
  var setTargetRef = (0, _hooks.useMergedRef)(targetRef);
  (0, _react.useImperativeHandle)(forwardedRef, function () {
    return {
      open: open,
      close: close
    };
  }, [popoverNode.current]);
  /**
   * Methods borrowed from BlueprintJS
   * https://github.com/palantir/blueprint/blob/release/2.0.0/packages/core/src/components/overlay/overlay.tsx
   */

  var bringFocusInside = (0, _react.useCallback)(function (e) {
    if (isShown && e) {
      e.preventDefault();
    } // Always delay focus manipulation to just before repaint to prevent scroll jumping


    return requestAnimationFrame(function () {
      // Container ref may be undefined between component mounting and Portal rendering
      // ActiveElement may be undefined in some rare cases in IE
      if (popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null || // eslint-disable-line eqeqeq, no-eq-null
      !isShown) {
        return;
      }

      var isFocusOutsideModal = !popoverNode.current.contains(document.activeElement);

      if (isFocusOutsideModal) {
        // Element marked autofocus has higher priority than the other elements
        var autofocusElement = popoverNode.current.querySelector('[autofocus]:not([disabled])');

        if (autofocusElement) {
          // Return early to avoid unnecessary dom queries
          return autofocusElement.focus();
        }

        var wrapperElement = popoverNode.current.querySelector('[tabindex]:not([disabled])');

        if (wrapperElement) {
          return wrapperElement.focus();
        }

        var buttonElements = popoverNode.current.querySelectorAll('button:not([disabled]), a:not([disabled]), [role="menuitem"]:not([disabled]), [role="menuitemradio"]:not([disabled])');

        if (buttonElements.length > 0) {
          return buttonElements[0].focus();
        }
      }
    });
  }, [isShown, popoverNode.current]);
  var bringFocusBackToTarget = (0, _react.useCallback)(function () {
    return requestAnimationFrame(function () {
      if (targetRef.current == null || // eslint-disable-line eqeqeq, no-eq-null
      popoverNode.current == null || // eslint-disable-line eqeqeq, no-eq-null
      document.activeElement == null // eslint-disable-line eqeqeq, no-eq-null
      ) {
        return;
      }

      var isFocusInsideModal = popoverNode.current.contains(document.activeElement); // Bring back focus on the target.

      if (document.activeElement === document.body || isFocusInsideModal) {
        targetRef.current.focus();
      }
    });
  }, [popoverNode.current, targetRef.current]);
  var open = (0, _react.useCallback)(function () {
    if (isShown) {
      return;
    }

    setIsShown(true);
    onOpen();
  }, [setIsShown, onOpen, isShown]);
  var close = (0, _react.useCallback)(function () {
    if (!isShown) {
      return;
    }

    setIsShown(false);
    bringFocusBackToTarget();
    onClose();
  }, [setIsShown, bringFocusBackToTarget, onClose, isShown]); // If `props.isShown` is a boolean, treat as a controlled component
  // `open` and `close` should be applied when it changes

  (0, _react.useEffect)(function () {
    if (typeof props.isShown !== 'boolean' || props.isShown === isShown) {
      return;
    }

    if (props.isShown) {
      open();
    } else {
      close();
    }
  }, [props.isShown, isShown]);
  var toggle = (0, _react.useCallback)(function () {
    return isShown ? close() : open();
  }, [isShown, close, open]);
  var handleOpenHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? open : undefined;
  }, [trigger, open]);
  var handleCloseHover = (0, _react.useMemo)(function () {
    return trigger === 'hover' ? close : undefined;
  }, [trigger, close]);
  var handleKeyDown = (0, _react.useCallback)(function (event) {
    return event.key === 'ArrowDown' ? bringFocusInside(event) : undefined;
  }, [bringFocusInside]);
  var onEsc = (0, _react.useCallback)(function (event) {
    return event.key === 'Escape' && shouldCloseOnEscapePress ? close() : undefined;
  }, [shouldCloseOnEscapePress, close]);
  var handleBodyClick = (0, _react.useCallback)(function (event) {
    // Ignore clicks on the popover or button
    if (targetRef.current && targetRef.current.contains(event.target)) {
      return;
    }

    if (popoverNode.current && popoverNode.current.contains(event.target)) {
      return;
    } // Notify body click


    onBodyClick(event);

    if (shouldCloseOnExternalClick !== false) {
      close();
    }
  }, [onBodyClick, shouldCloseOnExternalClick, close, targetRef.current, popoverNode.current]);
  var handleOpenComplete = (0, _react.useCallback)(function () {
    if (shouldBringFocusInside) bringFocusInside();
    onOpenComplete();
  }, [shouldBringFocusInside, bringFocusInside, onOpenComplete]);
  (0, _react.useEffect)(function () {
    if (isShown) {
      document.body.addEventListener('click', handleBodyClick, false);
      document.body.addEventListener('keydown', onEsc, false);
    } else {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    }

    return function () {
      document.body.removeEventListener('click', handleBodyClick, false);
      document.body.removeEventListener('keydown', onEsc, false);
    };
  }, [isShown, handleBodyClick, onEsc]);
  var renderTarget = (0, _react.useCallback)(function (_ref2) {
    var getRef = _ref2.getRef,
        isShown = _ref2.isShown;
    var isTooltipInside = children && children.type === _tooltip.Tooltip;

    var getTargetRef = function getTargetRef(ref) {
      setTargetRef(ref);
      getRef(ref);
    };
    /**
     * When a function is passed, you can control the Popover manually.
     */


    if (typeof children === 'function') {
      return children({
        getRef: getTargetRef,
        isShown: isShown,
        toggle: toggle
      });
    }

    var popoverTargetProps = {
      onClick: toggle,
      onMouseEnter: handleOpenHover,
      onKeyDown: handleKeyDown,
      role: 'button',
      'aria-expanded': isShown,
      'aria-haspopup': true
    };
    /**
     * Tooltips can be used within a Popover (not the other way around)
     * In this case the children is the Tooltip instead of a button.
     * Pass the properties to the Tooltip and let the Tooltip
     * add the properties to the target.
     */

    if (isTooltipInside) {
      return /*#__PURE__*/_react["default"].cloneElement(children, {
        popoverProps: _objectSpread({
          getTargetRef: getTargetRef,
          isShown: isShown
        }, popoverTargetProps)
      });
    }
    /**
     * With normal usage only popover props end up on the target.
     */


    return /*#__PURE__*/_react["default"].cloneElement(children, _objectSpread({
      ref: getTargetRef
    }, popoverTargetProps));
  }, [children, setTargetRef, toggle, handleOpenHover, handleKeyDown]); // If `props.isShown` is a boolean, popover is controlled manually, not via mouse events

  var shown = typeof props.isShown === 'boolean' ? props.isShown : isShown;
  var contentToRender = (0, _react.useMemo)(function () {
    return typeof content === 'function' ? content({
      close: close
    }) : content;
  }, [content, close]);
  return /*#__PURE__*/_react["default"].createElement(_positioner.Positioner, {
    target: renderTarget,
    isShown: shown,
    position: position,
    animationDuration: animationDuration,
    onOpenComplete: handleOpenComplete,
    onCloseComplete: onCloseComplete
  }, function (_ref3) {
    var css = _ref3.css,
        getRef = _ref3.getRef,
        state = _ref3.state,
        style = _ref3.style;
    return /*#__PURE__*/_react["default"].createElement(_PopoverStateless["default"], (0, _extends2["default"])({
      ref: function ref(_ref4) {
        setPopoverNode(_ref4);
        getRef(_ref4);
      },
      "data-state": state,
      display: display,
      minWidth: minWidth,
      minHeight: minHeight
    }, statelessProps, {
      className: (0, _classnames["default"])(statelessProps.className, (0, _glamor.css)(css, style, statelessProps.style).toString()) // Overwrite `statelessProps.style` since we are including it via className
      ,
      style: undefined,
      onMouseLeave: handleCloseHover
    }), contentToRender);
  });
}));
Popover.propTypes = {
  /**
   * The position the Popover is on. Smart positioning might override this.
   */
  position: _propTypes["default"].oneOf([_constants.Position.TOP, _constants.Position.TOP_LEFT, _constants.Position.TOP_RIGHT, _constants.Position.BOTTOM, _constants.Position.BOTTOM_LEFT, _constants.Position.BOTTOM_RIGHT, _constants.Position.LEFT, _constants.Position.RIGHT]),

  /**
   * When true, the Popover is manually shown.
   */
  isShown: _propTypes["default"].bool,

  /**
   * Open the Popover based on click or hover. Default is click.
   */
  trigger: _propTypes["default"].oneOf(['click', 'hover']),

  /**
   * The content of the Popover.
   */
  content: _propTypes["default"].oneOfType([_propTypes["default"].node, _propTypes["default"].func]).isRequired,

  /**
   * The target button of the Popover.
   * When a function the following arguments are passed:
   * ({ toggle: Function -> Void, getRef: Function -> Ref, isShown: Bool })
   */
  children: _propTypes["default"].oneOfType([_propTypes["default"].element, _propTypes["default"].func]).isRequired,

  /**
   * The display property passed to the Popover card.
   */
  display: _propTypes["default"].string,

  /**
   * The min width of the Popover card.
   */
  minWidth: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * The min height of the Popover card.
   */
  minHeight: _propTypes["default"].oneOfType([_propTypes["default"].number, _propTypes["default"].string]),

  /**
   * Properties passed through to the Popover card.
   */
  statelessProps: _propTypes["default"].shape(_PopoverStateless["default"].propTypes),

  /**
   * Duration of the animation.
   */
  animationDuration: _propTypes["default"].number,

  /**
   * Function called when the Popover opens.
   */
  onOpen: _propTypes["default"].func,

  /**
   * Function fired when Popover closes.
   */
  onClose: _propTypes["default"].func,

  /**
   * Function that will be called when the enter transition is complete.
   */
  onOpenComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the exit transition is complete.
   */
  onCloseComplete: _propTypes["default"].func,

  /**
   * Function that will be called when the body is clicked.
   */
  onBodyClick: _propTypes["default"].func,

  /**
   * When true, bring focus inside of the Popover on open.
   */
  bringFocusInside: _propTypes["default"].bool,

  /**
   * Boolean indicating if clicking outside the dialog should close the dialog.
   */
  shouldCloseOnExternalClick: _propTypes["default"].bool,

  /**
   * Boolean indicating if pressing the esc key should close the dialog.
   */
  shouldCloseOnEscapePress: _propTypes["default"].bool
};
var _default = Popover;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wb3BvdmVyL3NyYy9Qb3BvdmVyLmpzIl0sIm5hbWVzIjpbIm5vb3AiLCJlbXB0eVByb3BzIiwiUG9wb3ZlciIsImZvcndhcmRlZFJlZiIsImFuaW1hdGlvbkR1cmF0aW9uIiwiYnJpbmdGb2N1c0luc2lkZSIsInNob3VsZEJyaW5nRm9jdXNJbnNpZGUiLCJjaGlsZHJlbiIsImNvbnRlbnQiLCJkaXNwbGF5IiwibWluSGVpZ2h0IiwibWluV2lkdGgiLCJvbkJvZHlDbGljayIsIm9uQ2xvc2UiLCJvbkNsb3NlQ29tcGxldGUiLCJvbk9wZW4iLCJvbk9wZW5Db21wbGV0ZSIsInBvc2l0aW9uIiwiUG9zaXRpb24iLCJCT1RUT00iLCJzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljayIsInNob3VsZENsb3NlT25Fc2NhcGVQcmVzcyIsInN0YXRlbGVzc1Byb3BzIiwidHJpZ2dlciIsInByb3BzIiwiaXNTaG93biIsInNldElzU2hvd24iLCJwb3BvdmVyTm9kZSIsInNldFBvcG92ZXJOb2RlIiwidGFyZ2V0UmVmIiwic2V0VGFyZ2V0UmVmIiwib3BlbiIsImNsb3NlIiwiY3VycmVudCIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsImlzRm9jdXNPdXRzaWRlTW9kYWwiLCJjb250YWlucyIsImF1dG9mb2N1c0VsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJ3cmFwcGVyRWxlbWVudCIsImJ1dHRvbkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImJyaW5nRm9jdXNCYWNrVG9UYXJnZXQiLCJpc0ZvY3VzSW5zaWRlTW9kYWwiLCJib2R5IiwidG9nZ2xlIiwiaGFuZGxlT3BlbkhvdmVyIiwidW5kZWZpbmVkIiwiaGFuZGxlQ2xvc2VIb3ZlciIsImhhbmRsZUtleURvd24iLCJldmVudCIsImtleSIsIm9uRXNjIiwiaGFuZGxlQm9keUNsaWNrIiwidGFyZ2V0IiwiaGFuZGxlT3BlbkNvbXBsZXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJUYXJnZXQiLCJnZXRSZWYiLCJpc1Rvb2x0aXBJbnNpZGUiLCJ0eXBlIiwiVG9vbHRpcCIsImdldFRhcmdldFJlZiIsInJlZiIsInBvcG92ZXJUYXJnZXRQcm9wcyIsIm9uQ2xpY2siLCJvbk1vdXNlRW50ZXIiLCJvbktleURvd24iLCJyb2xlIiwiUmVhY3QiLCJjbG9uZUVsZW1lbnQiLCJwb3BvdmVyUHJvcHMiLCJzaG93biIsImNvbnRlbnRUb1JlbmRlciIsImNzcyIsInN0YXRlIiwic3R5bGUiLCJjbGFzc05hbWUiLCJ0b1N0cmluZyIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9uZU9mIiwiVE9QIiwiVE9QX0xFRlQiLCJUT1BfUklHSFQiLCJCT1RUT01fTEVGVCIsIkJPVFRPTV9SSUdIVCIsIkxFRlQiLCJSSUdIVCIsImJvb2wiLCJvbmVPZlR5cGUiLCJub2RlIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJlbGVtZW50Iiwic3RyaW5nIiwibnVtYmVyIiwic2hhcGUiLCJQb3BvdmVyU3RhdGVsZXNzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLElBQUksR0FBRyxTQUFQQSxJQUFPLEdBQU0sQ0FBRSxDQUFyQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUcsRUFBbkI7QUFFQSxJQUFNQyxPQUFPLGdCQUFHLCtCQUNkLHVCQUFXLFNBQVNBLE9BQVQsT0FxQlRDLFlBckJTLEVBc0JUO0FBQUEsbUNBcEJFQyxpQkFvQkY7QUFBQSxNQXBCRUEsaUJBb0JGLHNDQXBCc0IsR0FvQnRCO0FBQUEsbUNBbkJFQyxnQkFtQkY7QUFBQSxNQW5Cb0JDLHNCQW1CcEIsc0NBbkI2QyxLQW1CN0M7QUFBQSxNQWxCRUMsUUFr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YXJkUmVmLCB1c2VSZWYsIHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUltcGVyYXRpdmVIYW5kbGUsIHVzZUNhbGxiYWNrLCB1c2VNZW1vIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgY3ggZnJvbSAnY2xhc3NuYW1lcydcbmltcG9ydCB7IGNzcyBhcyBnbGFtb3JDc3MgfSBmcm9tICdnbGFtb3InXG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnXG5pbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gJy4uLy4uL2NvbnN0YW50cydcbmltcG9ydCB7IHVzZU1lcmdlZFJlZiB9IGZyb20gJy4uLy4uL2hvb2tzJ1xuaW1wb3J0IHsgUG9zaXRpb25lciB9IGZyb20gJy4uLy4uL3Bvc2l0aW9uZXInXG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnLi4vLi4vdG9vbHRpcCdcbmltcG9ydCBQb3BvdmVyU3RhdGVsZXNzIGZyb20gJy4vUG9wb3ZlclN0YXRlbGVzcydcblxuY29uc3Qgbm9vcCA9ICgpID0+IHt9XG5jb25zdCBlbXB0eVByb3BzID0ge31cblxuY29uc3QgUG9wb3ZlciA9IG1lbW8oXG4gIGZvcndhcmRSZWYoZnVuY3Rpb24gUG9wb3ZlcihcbiAgICB7XG4gICAgICBhbmltYXRpb25EdXJhdGlvbiA9IDMwMCxcbiAgICAgIGJyaW5nRm9jdXNJbnNpZGU6IHNob3VsZEJyaW5nRm9jdXNJbnNpZGUgPSBmYWxzZSxcbiAgICAgIGNoaWxkcmVuLFxuICAgICAgY29udGVudCxcbiAgICAgIGRpc3BsYXksXG4gICAgICBtaW5IZWlnaHQgPSA0MCxcbiAgICAgIG1pbldpZHRoID0gMjAwLFxuICAgICAgb25Cb2R5Q2xpY2sgPSBub29wLFxuICAgICAgb25DbG9zZSA9IG5vb3AsXG4gICAgICBvbkNsb3NlQ29tcGxldGUgPSBub29wLFxuICAgICAgb25PcGVuID0gbm9vcCxcbiAgICAgIG9uT3BlbkNvbXBsZXRlID0gbm9vcCxcbiAgICAgIHBvc2l0aW9uID0gUG9zaXRpb24uQk9UVE9NLFxuICAgICAgc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2sgPSB0cnVlLFxuICAgICAgc2hvdWxkQ2xvc2VPbkVzY2FwZVByZXNzID0gdHJ1ZSxcbiAgICAgIHN0YXRlbGVzc1Byb3BzID0gZW1wdHlQcm9wcyxcbiAgICAgIHRyaWdnZXIgPSAnY2xpY2snLFxuICAgICAgLi4ucHJvcHNcbiAgICB9LFxuICAgIGZvcndhcmRlZFJlZlxuICApIHtcbiAgICBjb25zdCBbaXNTaG93biwgc2V0SXNTaG93bl0gPSB1c2VTdGF0ZShwcm9wcy5pc1Nob3duKVxuICAgIGNvbnN0IHBvcG92ZXJOb2RlID0gdXNlUmVmKClcbiAgICBjb25zdCBzZXRQb3BvdmVyTm9kZSA9IHVzZU1lcmdlZFJlZihwb3BvdmVyTm9kZSlcbiAgICBjb25zdCB0YXJnZXRSZWYgPSB1c2VSZWYoKVxuICAgIGNvbnN0IHNldFRhcmdldFJlZiA9IHVzZU1lcmdlZFJlZih0YXJnZXRSZWYpXG5cbiAgICB1c2VJbXBlcmF0aXZlSGFuZGxlKFxuICAgICAgZm9yd2FyZGVkUmVmLFxuICAgICAgKCkgPT4gKHtcbiAgICAgICAgb3BlbixcbiAgICAgICAgY2xvc2VcbiAgICAgIH0pLFxuICAgICAgW3BvcG92ZXJOb2RlLmN1cnJlbnRdXG4gICAgKVxuXG4gICAgLyoqXG4gICAgICogTWV0aG9kcyBib3Jyb3dlZCBmcm9tIEJsdWVwcmludEpTXG4gICAgICogaHR0cHM6Ly9naXRodWIuY29tL3BhbGFudGlyL2JsdWVwcmludC9ibG9iL3JlbGVhc2UvMi4wLjAvcGFja2FnZXMvY29yZS9zcmMvY29tcG9uZW50cy9vdmVybGF5L292ZXJsYXkudHN4XG4gICAgICovXG4gICAgY29uc3QgYnJpbmdGb2N1c0luc2lkZSA9IHVzZUNhbGxiYWNrKFxuICAgICAgZSA9PiB7XG4gICAgICAgIGlmIChpc1Nob3duICYmIGUpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgfVxuICAgICAgICAvLyBBbHdheXMgZGVsYXkgZm9jdXMgbWFuaXB1bGF0aW9uIHRvIGp1c3QgYmVmb3JlIHJlcGFpbnQgdG8gcHJldmVudCBzY3JvbGwganVtcGluZ1xuXG4gICAgICAgIHJldHVybiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAgIC8vIENvbnRhaW5lciByZWYgbWF5IGJlIHVuZGVmaW5lZCBiZXR3ZWVuIGNvbXBvbmVudCBtb3VudGluZyBhbmQgUG9ydGFsIHJlbmRlcmluZ1xuXG4gICAgICAgICAgLy8gQWN0aXZlRWxlbWVudCBtYXkgYmUgdW5kZWZpbmVkIGluIHNvbWUgcmFyZSBjYXNlcyBpbiBJRVxuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgcG9wb3Zlck5vZGUuY3VycmVudCA9PSBudWxsIHx8IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZXFlcWVxLCBuby1lcS1udWxsXG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09IG51bGwgfHwgLy8gZXNsaW50LWRpc2FibGUtbGluZSBlcWVxZXEsIG5vLWVxLW51bGxcbiAgICAgICAgICAgICFpc1Nob3duXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBpc0ZvY3VzT3V0c2lkZU1vZGFsID0gIXBvcG92ZXJOb2RlLmN1cnJlbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudClcbiAgICAgICAgICBpZiAoaXNGb2N1c091dHNpZGVNb2RhbCkge1xuICAgICAgICAgICAgLy8gRWxlbWVudCBtYXJrZWQgYXV0b2ZvY3VzIGhhcyBoaWdoZXIgcHJpb3JpdHkgdGhhbiB0aGUgb3RoZXIgZWxlbWVudHNcbiAgICAgICAgICAgIGNvbnN0IGF1dG9mb2N1c0VsZW1lbnQgPSBwb3BvdmVyTm9kZS5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoJ1thdXRvZm9jdXNdOm5vdChbZGlzYWJsZWRdKScpXG4gICAgICAgICAgICBpZiAoYXV0b2ZvY3VzRWxlbWVudCkge1xuICAgICAgICAgICAgICAvLyBSZXR1cm4gZWFybHkgdG8gYXZvaWQgdW5uZWNlc3NhcnkgZG9tIHF1ZXJpZXNcbiAgICAgICAgICAgICAgcmV0dXJuIGF1dG9mb2N1c0VsZW1lbnQuZm9jdXMoKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCB3cmFwcGVyRWxlbWVudCA9IHBvcG92ZXJOb2RlLmN1cnJlbnQucXVlcnlTZWxlY3RvcignW3RhYmluZGV4XTpub3QoW2Rpc2FibGVkXSknKVxuICAgICAgICAgICAgaWYgKHdyYXBwZXJFbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiB3cmFwcGVyRWxlbWVudC5mb2N1cygpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnRzID0gcG9wb3Zlck5vZGUuY3VycmVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgICAgICAgICAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKSwgYTpub3QoW2Rpc2FibGVkXSksIFtyb2xlPVwibWVudWl0ZW1cIl06bm90KFtkaXNhYmxlZF0pLCBbcm9sZT1cIm1lbnVpdGVtcmFkaW9cIl06bm90KFtkaXNhYmxlZF0pJ1xuICAgICAgICAgICAgKVxuICAgICAgICAgICAgaWYgKGJ1dHRvbkVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbkVsZW1lbnRzWzBdLmZvY3VzKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgW2lzU2hvd24sIHBvcG92ZXJOb2RlLmN1cnJlbnRdXG4gICAgKVxuXG4gICAgY29uc3QgYnJpbmdGb2N1c0JhY2tUb1RhcmdldCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHJldHVybiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdGFyZ2V0UmVmLmN1cnJlbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgIHBvcG92ZXJOb2RlLmN1cnJlbnQgPT0gbnVsbCB8fCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT0gbnVsbCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGVxZXFlcSwgbm8tZXEtbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzRm9jdXNJbnNpZGVNb2RhbCA9IHBvcG92ZXJOb2RlLmN1cnJlbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudClcblxuICAgICAgICAvLyBCcmluZyBiYWNrIGZvY3VzIG9uIHRoZSB0YXJnZXQuXG4gICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSBkb2N1bWVudC5ib2R5IHx8IGlzRm9jdXNJbnNpZGVNb2RhbCkge1xuICAgICAgICAgIHRhcmdldFJlZi5jdXJyZW50LmZvY3VzKClcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LCBbcG9wb3Zlck5vZGUuY3VycmVudCwgdGFyZ2V0UmVmLmN1cnJlbnRdKVxuXG4gICAgY29uc3Qgb3BlbiA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmIChpc1Nob3duKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBzZXRJc1Nob3duKHRydWUpXG4gICAgICBvbk9wZW4oKVxuICAgIH0sIFtzZXRJc1Nob3duLCBvbk9wZW4sIGlzU2hvd25dKVxuXG4gICAgY29uc3QgY2xvc2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBpZiAoIWlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIHNldElzU2hvd24oZmFsc2UpXG4gICAgICBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0KClcbiAgICAgIG9uQ2xvc2UoKVxuICAgIH0sIFtzZXRJc1Nob3duLCBicmluZ0ZvY3VzQmFja1RvVGFyZ2V0LCBvbkNsb3NlLCBpc1Nob3duXSlcblxuICAgIC8vIElmIGBwcm9wcy5pc1Nob3duYCBpcyBhIGJvb2xlYW4sIHRyZWF0IGFzIGEgY29udHJvbGxlZCBjb21wb25lbnRcbiAgICAvLyBgb3BlbmAgYW5kIGBjbG9zZWAgc2hvdWxkIGJlIGFwcGxpZWQgd2hlbiBpdCBjaGFuZ2VzXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmICh0eXBlb2YgcHJvcHMuaXNTaG93biAhPT0gJ2Jvb2xlYW4nIHx8IHByb3BzLmlzU2hvd24gPT09IGlzU2hvd24pIHtcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG5cbiAgICAgIGlmIChwcm9wcy5pc1Nob3duKSB7XG4gICAgICAgIG9wZW4oKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2xvc2UoKVxuICAgICAgfVxuICAgIH0sIFtwcm9wcy5pc1Nob3duLCBpc1Nob3duXSlcblxuICAgIGNvbnN0IHRvZ2dsZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHJldHVybiBpc1Nob3duID8gY2xvc2UoKSA6IG9wZW4oKVxuICAgIH0sIFtpc1Nob3duLCBjbG9zZSwgb3Blbl0pXG5cbiAgICBjb25zdCBoYW5kbGVPcGVuSG92ZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0cmlnZ2VyID09PSAnaG92ZXInID8gb3BlbiA6IHVuZGVmaW5lZFxuICAgIH0sIFt0cmlnZ2VyLCBvcGVuXSlcblxuICAgIGNvbnN0IGhhbmRsZUNsb3NlSG92ZXIgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgIHJldHVybiB0cmlnZ2VyID09PSAnaG92ZXInID8gY2xvc2UgOiB1bmRlZmluZWRcbiAgICB9LCBbdHJpZ2dlciwgY2xvc2VdKVxuXG4gICAgY29uc3QgaGFuZGxlS2V5RG93biA9IHVzZUNhbGxiYWNrKFxuICAgICAgZXZlbnQgPT4ge1xuICAgICAgICByZXR1cm4gZXZlbnQua2V5ID09PSAnQXJyb3dEb3duJyA/IGJyaW5nRm9jdXNJbnNpZGUoZXZlbnQpIDogdW5kZWZpbmVkXG4gICAgICB9LFxuICAgICAgW2JyaW5nRm9jdXNJbnNpZGVdXG4gICAgKVxuXG4gICAgY29uc3Qgb25Fc2MgPSB1c2VDYWxsYmFjayhcbiAgICAgIGV2ZW50ID0+IHtcbiAgICAgICAgcmV0dXJuIGV2ZW50LmtleSA9PT0gJ0VzY2FwZScgJiYgc2hvdWxkQ2xvc2VPbkVzY2FwZVByZXNzID8gY2xvc2UoKSA6IHVuZGVmaW5lZFxuICAgICAgfSxcbiAgICAgIFtzaG91bGRDbG9zZU9uRXNjYXBlUHJlc3MsIGNsb3NlXVxuICAgIClcblxuICAgIGNvbnN0IGhhbmRsZUJvZHlDbGljayA9IHVzZUNhbGxiYWNrKFxuICAgICAgZXZlbnQgPT4ge1xuICAgICAgICAvLyBJZ25vcmUgY2xpY2tzIG9uIHRoZSBwb3BvdmVyIG9yIGJ1dHRvblxuICAgICAgICBpZiAodGFyZ2V0UmVmLmN1cnJlbnQgJiYgdGFyZ2V0UmVmLmN1cnJlbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHBvcG92ZXJOb2RlLmN1cnJlbnQgJiYgcG9wb3Zlck5vZGUuY3VycmVudC5jb250YWlucyhldmVudC50YXJnZXQpKSB7XG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb3RpZnkgYm9keSBjbGlja1xuICAgICAgICBvbkJvZHlDbGljayhldmVudClcblxuICAgICAgICBpZiAoc2hvdWxkQ2xvc2VPbkV4dGVybmFsQ2xpY2sgIT09IGZhbHNlKSB7XG4gICAgICAgICAgY2xvc2UoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW29uQm9keUNsaWNrLCBzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljaywgY2xvc2UsIHRhcmdldFJlZi5jdXJyZW50LCBwb3BvdmVyTm9kZS5jdXJyZW50XVxuICAgIClcblxuICAgIGNvbnN0IGhhbmRsZU9wZW5Db21wbGV0ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmIChzaG91bGRCcmluZ0ZvY3VzSW5zaWRlKSBicmluZ0ZvY3VzSW5zaWRlKClcbiAgICAgIG9uT3BlbkNvbXBsZXRlKClcbiAgICB9LCBbc2hvdWxkQnJpbmdGb2N1c0luc2lkZSwgYnJpbmdGb2N1c0luc2lkZSwgb25PcGVuQ29tcGxldGVdKVxuXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgIGlmIChpc1Nob3duKSB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVCb2R5Q2xpY2ssIGZhbHNlKVxuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkVzYywgZmFsc2UpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQm9keUNsaWNrLCBmYWxzZSlcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25Fc2MsIGZhbHNlKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQm9keUNsaWNrLCBmYWxzZSlcbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25Fc2MsIGZhbHNlKVxuICAgICAgfVxuICAgIH0sIFtpc1Nob3duLCBoYW5kbGVCb2R5Q2xpY2ssIG9uRXNjXSlcblxuICAgIGNvbnN0IHJlbmRlclRhcmdldCA9IHVzZUNhbGxiYWNrKFxuICAgICAgKHsgZ2V0UmVmLCBpc1Nob3duIH0pID0+IHtcbiAgICAgICAgY29uc3QgaXNUb29sdGlwSW5zaWRlID0gY2hpbGRyZW4gJiYgY2hpbGRyZW4udHlwZSA9PT0gVG9vbHRpcFxuXG4gICAgICAgIGNvbnN0IGdldFRhcmdldFJlZiA9IHJlZiA9PiB7XG4gICAgICAgICAgc2V0VGFyZ2V0UmVmKHJlZilcbiAgICAgICAgICBnZXRSZWYocmVmKVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZW4gYSBmdW5jdGlvbiBpcyBwYXNzZWQsIHlvdSBjYW4gY29udHJvbCB0aGUgUG9wb3ZlciBtYW51YWxseS5cbiAgICAgICAgICovXG4gICAgICAgIGlmICh0eXBlb2YgY2hpbGRyZW4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGRyZW4oe1xuICAgICAgICAgICAgZ2V0UmVmOiBnZXRUYXJnZXRSZWYsXG4gICAgICAgICAgICBpc1Nob3duLFxuICAgICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHBvcG92ZXJUYXJnZXRQcm9wcyA9IHtcbiAgICAgICAgICBvbkNsaWNrOiB0b2dnbGUsXG4gICAgICAgICAgb25Nb3VzZUVudGVyOiBoYW5kbGVPcGVuSG92ZXIsXG4gICAgICAgICAgb25LZXlEb3duOiBoYW5kbGVLZXlEb3duLFxuICAgICAgICAgIHJvbGU6ICdidXR0b24nLFxuICAgICAgICAgICdhcmlhLWV4cGFuZGVkJzogaXNTaG93bixcbiAgICAgICAgICAnYXJpYS1oYXNwb3B1cCc6IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb29sdGlwcyBjYW4gYmUgdXNlZCB3aXRoaW4gYSBQb3BvdmVyIChub3QgdGhlIG90aGVyIHdheSBhcm91bmQpXG4gICAgICAgICAqIEluIHRoaXMgY2FzZSB0aGUgY2hpbGRyZW4gaXMgdGhlIFRvb2x0aXAgaW5zdGVhZCBvZiBhIGJ1dHRvbi5cbiAgICAgICAgICogUGFzcyB0aGUgcHJvcGVydGllcyB0byB0aGUgVG9vbHRpcCBhbmQgbGV0IHRoZSBUb29sdGlwXG4gICAgICAgICAqIGFkZCB0aGUgcHJvcGVydGllcyB0byB0aGUgdGFyZ2V0LlxuICAgICAgICAgKi9cbiAgICAgICAgaWYgKGlzVG9vbHRpcEluc2lkZSkge1xuICAgICAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgICAgIHBvcG92ZXJQcm9wczoge1xuICAgICAgICAgICAgICBnZXRUYXJnZXRSZWYsXG4gICAgICAgICAgICAgIGlzU2hvd24sXG5cbiAgICAgICAgICAgICAgLy8gVGhlc2UgcHJvcGV0aWVzIHdpbGwgYmUgc3ByZWFkIGFzIGBwb3BvdmVyVGFyZ2V0UHJvcHNgXG4gICAgICAgICAgICAgIC8vIGluIHRoZSBUb29sdGlwIGNvbXBvbmVudC5cbiAgICAgICAgICAgICAgLi4ucG9wb3ZlclRhcmdldFByb3BzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaXRoIG5vcm1hbCB1c2FnZSBvbmx5IHBvcG92ZXIgcHJvcHMgZW5kIHVwIG9uIHRoZSB0YXJnZXQuXG4gICAgICAgICAqL1xuICAgICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCB7XG4gICAgICAgICAgcmVmOiBnZXRUYXJnZXRSZWYsXG4gICAgICAgICAgLi4ucG9wb3ZlclRhcmdldFByb3BzXG4gICAgICAgIH0pXG4gICAgICB9LFxuICAgICAgW2NoaWxkcmVuLCBzZXRUYXJnZXRSZWYsIHRvZ2dsZSwgaGFuZGxlT3BlbkhvdmVyLCBoYW5kbGVLZXlEb3duXVxuICAgIClcblxuICAgIC8vIElmIGBwcm9wcy5pc1Nob3duYCBpcyBhIGJvb2xlYW4sIHBvcG92ZXIgaXMgY29udHJvbGxlZCBtYW51YWxseSwgbm90IHZpYSBtb3VzZSBldmVudHNcbiAgICBjb25zdCBzaG93biA9IHR5cGVvZiBwcm9wcy5pc1Nob3duID09PSAnYm9vbGVhbicgPyBwcm9wcy5pc1Nob3duIDogaXNTaG93blxuXG4gICAgY29uc3QgY29udGVudFRvUmVuZGVyID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICByZXR1cm4gdHlwZW9mIGNvbnRlbnQgPT09ICdmdW5jdGlvbicgPyBjb250ZW50KHsgY2xvc2UgfSkgOiBjb250ZW50XG4gICAgfSwgW2NvbnRlbnQsIGNsb3NlXSlcblxuICAgIHJldHVybiAoXG4gICAgICA8UG9zaXRpb25lclxuICAgICAgICB0YXJnZXQ9e3JlbmRlclRhcmdldH1cbiAgICAgICAgaXNTaG93bj17c2hvd259XG4gICAgICAgIHBvc2l0aW9uPXtwb3NpdGlvbn1cbiAgICAgICAgYW5pbWF0aW9uRHVyYXRpb249e2FuaW1hdGlvbkR1cmF0aW9ufVxuICAgICAgICBvbk9wZW5Db21wbGV0ZT17aGFuZGxlT3BlbkNvbXBsZXRlfVxuICAgICAgICBvbkNsb3NlQ29tcGxldGU9e29uQ2xvc2VDb21wbGV0ZX1cbiAgICAgID5cbiAgICAgICAgeyh7IGNzcywgZ2V0UmVmLCBzdGF0ZSwgc3R5bGUgfSkgPT4gKFxuICAgICAgICAgIDxQb3BvdmVyU3RhdGVsZXNzXG4gICAgICAgICAgICByZWY9e3JlZiA9PiB7XG4gICAgICAgICAgICAgIHNldFBvcG92ZXJOb2RlKHJlZilcbiAgICAgICAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICAgIGRpc3BsYXk9e2Rpc3BsYXl9XG4gICAgICAgICAgICBtaW5XaWR0aD17bWluV2lkdGh9XG4gICAgICAgICAgICBtaW5IZWlnaHQ9e21pbkhlaWdodH1cbiAgICAgICAgICAgIHsuLi5zdGF0ZWxlc3NQcm9wc31cbiAgICAgICAgICAgIGNsYXNzTmFtZT17Y3goc3RhdGVsZXNzUHJvcHMuY2xhc3NOYW1lLCBnbGFtb3JDc3MoY3NzLCBzdHlsZSwgc3RhdGVsZXNzUHJvcHMuc3R5bGUpLnRvU3RyaW5nKCkpfVxuICAgICAgICAgICAgLy8gT3ZlcndyaXRlIGBzdGF0ZWxlc3NQcm9wcy5zdHlsZWAgc2luY2Ugd2UgYXJlIGluY2x1ZGluZyBpdCB2aWEgY2xhc3NOYW1lXG4gICAgICAgICAgICBzdHlsZT17dW5kZWZpbmVkfVxuICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXtoYW5kbGVDbG9zZUhvdmVyfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtjb250ZW50VG9SZW5kZXJ9XG4gICAgICAgICAgPC9Qb3BvdmVyU3RhdGVsZXNzPlxuICAgICAgICApfVxuICAgICAgPC9Qb3NpdGlvbmVyPlxuICAgIClcbiAgfSlcbilcblxuUG9wb3Zlci5wcm9wVHlwZXMgPSB7XG4gIC8qKlxuICAgKiBUaGUgcG9zaXRpb24gdGhlIFBvcG92ZXIgaXMgb24uIFNtYXJ0IHBvc2l0aW9uaW5nIG1pZ2h0IG92ZXJyaWRlIHRoaXMuXG4gICAqL1xuICBwb3NpdGlvbjogUHJvcFR5cGVzLm9uZU9mKFtcbiAgICBQb3NpdGlvbi5UT1AsXG4gICAgUG9zaXRpb24uVE9QX0xFRlQsXG4gICAgUG9zaXRpb24uVE9QX1JJR0hULFxuICAgIFBvc2l0aW9uLkJPVFRPTSxcbiAgICBQb3NpdGlvbi5CT1RUT01fTEVGVCxcbiAgICBQb3NpdGlvbi5CT1RUT01fUklHSFQsXG4gICAgUG9zaXRpb24uTEVGVCxcbiAgICBQb3NpdGlvbi5SSUdIVFxuICBdKSxcblxuICAvKipcbiAgICogV2hlbiB0cnVlLCB0aGUgUG9wb3ZlciBpcyBtYW51YWxseSBzaG93bi5cbiAgICovXG4gIGlzU2hvd246IFByb3BUeXBlcy5ib29sLFxuICAvKipcbiAgICogT3BlbiB0aGUgUG9wb3ZlciBiYXNlZCBvbiBjbGljayBvciBob3Zlci4gRGVmYXVsdCBpcyBjbGljay5cbiAgICovXG4gIHRyaWdnZXI6IFByb3BUeXBlcy5vbmVPZihbJ2NsaWNrJywgJ2hvdmVyJ10pLFxuXG4gIC8qKlxuICAgKiBUaGUgY29udGVudCBvZiB0aGUgUG9wb3Zlci5cbiAgICovXG4gIGNvbnRlbnQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5ub2RlLCBQcm9wVHlwZXMuZnVuY10pLmlzUmVxdWlyZWQsXG5cbiAgLyoqXG4gICAqIFRoZSB0YXJnZXQgYnV0dG9uIG9mIHRoZSBQb3BvdmVyLlxuICAgKiBXaGVuIGEgZnVuY3Rpb24gdGhlIGZvbGxvd2luZyBhcmd1bWVudHMgYXJlIHBhc3NlZDpcbiAgICogKHsgdG9nZ2xlOiBGdW5jdGlvbiAtPiBWb2lkLCBnZXRSZWY6IEZ1bmN0aW9uIC0+IFJlZiwgaXNTaG93bjogQm9vbCB9KVxuICAgKi9cbiAgY2hpbGRyZW46IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5lbGVtZW50LCBQcm9wVHlwZXMuZnVuY10pLmlzUmVxdWlyZWQsXG5cbiAgLyoqXG4gICAqIFRoZSBkaXNwbGF5IHByb3BlcnR5IHBhc3NlZCB0byB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgZGlzcGxheTogUHJvcFR5cGVzLnN0cmluZyxcblxuICAvKipcbiAgICogVGhlIG1pbiB3aWR0aCBvZiB0aGUgUG9wb3ZlciBjYXJkLlxuICAgKi9cbiAgbWluV2lkdGg6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5zdHJpbmddKSxcblxuICAvKipcbiAgICogVGhlIG1pbiBoZWlnaHQgb2YgdGhlIFBvcG92ZXIgY2FyZC5cbiAgICovXG4gIG1pbkhlaWdodDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm51bWJlciwgUHJvcFR5cGVzLnN0cmluZ10pLFxuXG4gIC8qKlxuICAgKiBQcm9wZXJ0aWVzIHBhc3NlZCB0aHJvdWdoIHRvIHRoZSBQb3BvdmVyIGNhcmQuXG4gICAqL1xuICBzdGF0ZWxlc3NQcm9wczogUHJvcFR5cGVzLnNoYXBlKFBvcG92ZXJTdGF0ZWxlc3MucHJvcFR5cGVzKSxcblxuICAvKipcbiAgICogRHVyYXRpb24gb2YgdGhlIGFuaW1hdGlvbi5cbiAgICovXG4gIGFuaW1hdGlvbkR1cmF0aW9uOiBQcm9wVHlwZXMubnVtYmVyLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgUG9wb3ZlciBvcGVucy5cbiAgICovXG4gIG9uT3BlbjogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIGZpcmVkIHdoZW4gUG9wb3ZlciBjbG9zZXMuXG4gICAqL1xuICBvbkNsb3NlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAvKipcbiAgICogRnVuY3Rpb24gdGhhdCB3aWxsIGJlIGNhbGxlZCB3aGVuIHRoZSBlbnRlciB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlLlxuICAgKi9cbiAgb25PcGVuQ29tcGxldGU6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBGdW5jdGlvbiB0aGF0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGV4aXQgdHJhbnNpdGlvbiBpcyBjb21wbGV0ZS5cbiAgICovXG4gIG9uQ2xvc2VDb21wbGV0ZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgLyoqXG4gICAqIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgYm9keSBpcyBjbGlja2VkLlxuICAgKi9cbiAgb25Cb2R5Q2xpY2s6IFByb3BUeXBlcy5mdW5jLFxuXG4gIC8qKlxuICAgKiBXaGVuIHRydWUsIGJyaW5nIGZvY3VzIGluc2lkZSBvZiB0aGUgUG9wb3ZlciBvbiBvcGVuLlxuICAgKi9cbiAgYnJpbmdGb2N1c0luc2lkZTogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBjbGlja2luZyBvdXRzaWRlIHRoZSBkaWFsb2cgc2hvdWxkIGNsb3NlIHRoZSBkaWFsb2cuXG4gICAqL1xuICBzaG91bGRDbG9zZU9uRXh0ZXJuYWxDbGljazogUHJvcFR5cGVzLmJvb2wsXG5cbiAgLyoqXG4gICAqIEJvb2xlYW4gaW5kaWNhdGluZyBpZiBwcmVzc2luZyB0aGUgZXNjIGtleSBzaG91bGQgY2xvc2UgdGhlIGRpYWxvZy5cbiAgICovXG4gIHNob3VsZENsb3NlT25Fc2NhcGVQcmVzczogUHJvcFR5cGVzLmJvb2xcbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wb3ZlclxuIl19